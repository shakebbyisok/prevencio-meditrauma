{% extends 'theme/template.html.twig' %}
{% trans_default_domain 'empresas' %}

{% block arrow %}<a href="{{ path('medico_empresa_show') }}" style="color: black;" onclick="return confirm('{% trans from 'messages' %}TRANS_CONFIRM_RETURN{% endtrans %}')"><i class="icon-arrow-left52 mr-2"></i></a>{% endblock %}
{% block title %} {% trans %}TRANS_EMPRESA{% endtrans %} {% endblock %}
{% block subtitle %}
    {% if (app.request.get('id') is defined and app.request.get('id') is not empty ) %}
        {{ form.vars.value.empresa }}
    {% else %}
        {% trans from 'messages' %}TRANS_NUEVA{% endtrans %}
    {% endif %}
{% endblock %}

{% block card %}

<style>
    .custom-file-label { opacity: 0; }
    .custom-file-input { opacity: 1; }
</style>

    <link href="{{ asset('jstree/themes/default/style.min.css') }}" rel="stylesheet" type="text/css">
    <script src="{{ asset('jstree/jstree.min.js') }}"></script>

    <script type="text/javascript">
        $(document).ready(function(){
            $('.summernote').summernote();

            var arrayDataTrabajadores = [];
            var arrayDataMemorias = [];
            var arrayDataEstudios = [];
            var arrayDataRevisiones = [];

            $.extend( $.fn.dataTable.defaults, {
                autoWidth: true,
                columnDefs: [{
                    width: 100,
                }],
                ordering: true,
                deferRender: false,
                dom: '<"datatable-header"fBl><"datatable-scroll-wrap"t><"datatable-footer"ip>',
                language: {
                    search: '<span>Filtrar:</span> _INPUT_',
                    searchPlaceholder: 'Escriba para filtrar...',
                    lengthMenu: '<span>Mostrar:</span> _MENU_',
                    paginate: { 'first': 'First', 'last': 'Last', 'next': $('html').attr('dir') == 'rtl' ? '&larr;' : '&rarr;', 'previous': $('html').attr('dir') == 'rtl' ? '&rarr;' : '&larr;' }
                },
            });

            {% for te in trabajadoresEmpresa %}
                var array = [];
                var actions = '<div class="list-icons">';

                {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                    {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                        actions += '<a href="{{ path('medico_trabajador_update', { "id": te.id }) }}" target="_blank" class="list-icons-item" data-popup="tooltip" title="Editar" data-container="body"><i class="icon-pencil7"></i></a>';
                        actions += '<a href="#" data-id="{{ te.id }}" target="_self" class="list-icons-item eliminarTrabajador"><i class="icon-trash"></i></a>';
                    {% endif %}
                {% endif %}

                actions += '</div>';

                var apto = '';

                {% if te.apto is not empty %}
                    {% if te.apto == 1 %}
                        apto = '<span class="badge badge-success"><i class="icon-check"></i></span>';
                    {% elseif te.apto == 2 %}
                        apto = '<span class="badge badge-warning"><i class="icon-check"></i></span>';
                    {% elseif te.apto == 3 %}
                        apto = '<span class="badge badge-danger"><i class="icon-cross"></i></span>';
                    {% endif %}
                {% else %}
                    apto = '';
                {% endif %}

                array.push('{{ te.trabajador }}', '{{ te.dni }}', '{{ te.puesto }}', '{{ te.fechaultima }}', apto, actions);
                arrayDataTrabajadores.push(array);
            {% endfor %}

            $('.datatable-export-excel-trabajadores').DataTable({
                data: arrayDataTrabajadores,
                buttons: {
                    buttons: [
                        {
                            extend: 'excelHtml5',
                            className: 'btn btn-success',
                            text: '<i class="icon-file-spreadsheet mr-2"></i> Exportar a Excel',
                            fieldSeparator: '\t',
                            extension: '.xlsx'
                        }
                    ]
                }
            });

            {% if app.session.get('privilegiosRol').exportEmpresaMedicoSn is defined and app.session.get('privilegiosRol').exportEmpresaMedicoSn is not null %}
                {% if app.session.get('privilegiosRol').exportEmpresaMedicoSn != true %}
                    $('#datatable-trabajadores .dt-buttons').css('display', 'none');
                {% endif %}
            {% endif %}

            {% for me in memoriaEmpresa %}
                var array = [];
                var actions = '<div class="list-icons">';

                {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                    {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                        {% if me.fichero is not null %}
                            actions += '<a href="{{ path('gdoc_open_file', { "fileId": me.fichero.id, "tipo": "1" }) }}" class="list-icons-item" target="_blank" data-popup="tooltip" title="Imprimir" data-container="body"><i class="icon-printer2"></i></a>';
                        {% endif %}
                    {% endif %}
                {% endif %}

                {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                    {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                        actions += '<a href="#" data-id="{{ me.fichero.id }}" target="_self" class="list-icons-item eliminarMemoria"><i class="icon-trash"></i></a>';
                    {% endif %}
                {% endif %}

                actions += '</div>';

                array.push('{{ me.anyo }}', actions);
                arrayDataMemorias.push(array);
            {% endfor %}

            $('.datatable-export-excel-memorias').DataTable({
                data: arrayDataMemorias,
                buttons: {
                    buttons: [
                        {
                            extend: 'excelHtml5',
                            className: 'btn btn-success',
                            text: '<i class="icon-file-spreadsheet mr-2"></i> Exportar a Excel',
                            fieldSeparator: '\t',
                            extension: '.xlsx'
                        }
                    ]
                }
            });

            {% if app.session.get('privilegiosRol').exportEmpresaMedicoSn is defined and app.session.get('privilegiosRol').exportEmpresaMedicoSn is not null %}
                {% if app.session.get('privilegiosRol').exportEmpresaMedicoSn != true %}
                    $('#datatable-memorias .dt-buttons').css('display', 'none');
                {% endif %}
            {% endif %}

            {% for e in estudioEmpresa %}
                var array = [];
                var actions = '<div class="list-icons">';

                {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                    {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                        {% if e.fichero is not null %}
                            actions += '<a href="{{ path('gdoc_open_file', { "fileId": e.fichero.id, "tipo": "16" }) }}" class="list-icons-item" target="_blank" data-popup="tooltip" title="Imprimir" data-container="body"><i class="icon-printer2"></i></a>';
                        {% endif %}
                    {% endif %}
                {% endif %}

                {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                    {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                        actions += '<a href="#" data-id="{{ e.fichero.id }}" target="_self" class="list-icons-item eliminarEstudio"><i class="icon-trash"></i></a>';
                    {% endif %}
                {% endif %}

                actions += '</div>';

                array.push('{{ e.anyo }}', actions);
                arrayDataEstudios.push(array);
            {% endfor %}

            $('.datatable-export-excel-estudios').DataTable({
                data: arrayDataEstudios,
                buttons: {
                    buttons: [
                        {
                            extend: 'excelHtml5',
                            className: 'btn btn-success',
                            text: '<i class="icon-file-spreadsheet mr-2"></i> Exportar a Excel',
                            fieldSeparator: '\t',
                            extension: '.xlsx'
                        }
                    ]
                }
            });

            {% if app.session.get('privilegiosRol').exportEmpresaMedicoSn is defined and app.session.get('privilegiosRol').exportEmpresaMedicoSn is not null %}
                {% if app.session.get('privilegiosRol').exportEmpresaMedicoSn != true %}
                    $('#datatable-estudios .dt-buttons').css('display', 'none');
                {% endif %}
            {% endif %}

            {% for r in revisionEmpresa %}
                var array = [];
                var actions = '<div class="list-icons">';

                {% if app.session.get('privilegiosRol').editRevisionSn is defined and app.session.get('privilegiosRol').editRevisionSn is not null %}
                    {% if app.session.get('privilegiosRol').editRevisionSn and impagadaSn is defined and impagadaSn == false %}
                        actions += '<a href="{{ path('medico_revision_update', { "id": r.id }) }}" target="_blank" class="list-icons-item" data-popup="tooltip" title="Editar" data-container="body"><i class="icon-pencil7"></i></a>';
                    {% endif %}
                {% endif %}

                {% if r.apto_id is not empty %}
                    {% if app.session.get('privilegiosRol').printAptitudRevisionSn is defined and app.session.get('privilegiosRol').printAptitudRevisionSn is not null %}
                        {% if app.session.get('privilegiosRol').printAptitudRevisionSn and impagadaSn is defined and impagadaSn == false %}
                            {% if r.fichero_id is not null %}
                                actions += '<a href="{{ path('gdoc_open_file', { "fileId": r.fichero_id, "tipo": "11" }) }}" class="list-icons-item" target="_blank" data-popup="tooltip" title="Imprimir aptitud" data-container="body"><i class="icon-file-check"></i></a>';
                                {% if app.session.get('privilegiosRol').deleteGdocFileSn is defined and app.session.get('privilegiosRol').deleteGdocFileSn is not null %}
                                    {% if app.session.get('privilegiosRol').deleteGdocFileSn and impagadaSn is defined and impagadaSn == false %}
                                        actions += '<a href="#" data-id="{{ r.fichero_id }}" class="list-icons-item eliminarAptitud" data-popup="tooltip" title="Eliminar aptitud" data-container="body"><i class="icon-file-minus"></i></a>';
                                    {% endif %}
                                {% endif %}
                            {% else %}
                                actions += '<a href="#" data-id="{{ r.id }}" class="list-icons-item selectAptitud" data-popup="tooltip" title="Imprimir aptitud" data-container="body" data-toggle="modal" data-target="#modal_print_aptitud"><i class="icon-file-check"></i></a>';
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endif %}

                {% if app.session.get('privilegiosRol').printResumenRevisionSn is defined and app.session.get('privilegiosRol').printResumenRevisionSn is not null %}
                    {% if app.session.get('privilegiosRol').printResumenRevisionSn and impagadaSn is defined and impagadaSn == false %}
                        {% if r.fichero_resumen_id is not null %}
                            actions += '<a href="{{ path('gdoc_open_file', { "fileId": r.fichero_resumen_id, "tipo": "13" }) }}" class="list-icons-item" target="_blank" data-popup="tooltip" title="Imprimir resumen" data-container="body"><i class="icon-file-text2"></i></a>';
                                {% if app.session.get('privilegiosRol').deleteGdocFileSn is defined and app.session.get('privilegiosRol').deleteGdocFileSn is not null %}
                                    {% if app.session.get('privilegiosRol').deleteGdocFileSn %}
                                        actions += '<a href="#" data-id="{{ r.fichero_resumen_id }}" class="list-icons-item eliminarResumen" data-popup="tooltip" title="Eliminar resumen" data-container="body"><i class="icon-file-minus"></i></a>';
                                    {% endif %}
                                {% endif %}
                        {% else %}
                                actions += '<a href="#" data-id="{{ r.id }}" class="list-icons-item selectRevision" data-popup="tooltip" title="Imprimir resumen" data-container="body" data-toggle="modal" data-target="#modal_resumen_revision"><i class="icon-file-text2"></i></a>';
                        {% endif %}
                    {% endif %}
                {% endif %}

                {% if app.session.get('privilegiosRol').deleteRevisionSn is defined and app.session.get('privilegiosRol').deleteRevisionSn is not null %}
                    {% if app.session.get('privilegiosRol').deleteRevisionSn and impagadaSn is defined and impagadaSn == false %}
                        actions += '<a href="#" data-id="{{ r.id }}" class="list-icons-item eliminarRevision" target="_self"><i class="icon-trash"></i></a>';
                    {% endif %}
                {% endif %}

                actions += '</div>';

                var estado = '';
                {% if r.estadoid is not empty %}
                    {% if r.estadoid == 1 %}
                        estado = '<span class="badge badge-primary"><i class="icon-eye-blocked"></i> {{ r.estado }}</span>';
                    {% elseif r.estadoid == 2 %}
                        estado = '<span class="badge badge-warning"><i class="icon-eye"></i> {{ r.estado }}</span>';
                    {% elseif r.estadoid == 3 %}
                        estado = '<span class="badge badge-info"><i class="icon-highlight"></i> {{ r.estado }}</span>';
                    {% elseif r.estadoid == 4 %}
                        estado = '<span class="badge badge-success"><i class="icon-cash"></i> {{ r.estado }}</span>';
                    {% endif %}
                {% endif %}

                var apto = '';

                {% if r.apto_id is not empty %}
                    {% if r.apto_id == 1 %}
                        apto = '<span class="badge badge-success"><i class="icon-check"></i></span>';
                    {% elseif r.apto_id == 2 %}
                        apto = '<span class="badge badge-warning"><i class="icon-check"></i></span>';
                    {% elseif r.apto_id == 3 %}
                        apto = '<span class="badge badge-danger"><i class="icon-cross"></i></span>';
                    {% endif %}
                {% endif %}

                array.push(estado, '<span style="display:none;">{{ r.fechatimestamp }}</span>{{ r.fecha }}', '{{ r.trabajador }}', '{{ r.puesto }}', '{{ r.empresa }}', '{{ r.doctor }}', apto, actions);
                arrayDataRevisiones.push(array);
            {% endfor %}

            $('.datatable-export-excel-revisiones').DataTable({
                data: arrayDataRevisiones,
                buttons: {
                    buttons: [
                        {
                            extend: 'excelHtml5',
                            className: 'btn btn-success',
                            text: '<i class="icon-file-spreadsheet mr-2"></i> Exportar a Excel',
                            fieldSeparator: '\t',
                            extension: '.xlsx'
                        }
                    ]
                }
            });

            {% if app.session.get('privilegiosRol').exportEmpresaMedicoSn is defined and app.session.get('privilegiosRol').exportEmpresaMedicoSn is not null %}
                {% if app.session.get('privilegiosRol').exportEmpresaMedicoSn != true %}
                    $('#datatable-revisiones .dt-buttons').css('display', 'none');
                {% endif %}
            {% endif %}

            //Boton para añadir un cnae
            $('#btnAddCnae').click(function(){

                if($('#cnaeValor').val() == ''){
                    $('#cnaeValor').focus();
                    return false;
                }

                $('#btnAddCnae').prop("disabled", true);
                $('#btnAddCnae').html("<i class=\"icon-spinner2 spinner mr-2\"></i>{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}");

                $.ajax({
                    type: "POST",
                    url: "{{ path('empresa_add_cnae') }}",
                    data: {
                        'cnaeId': $('#cnaeValor').val(),
                        'principal': $('#principal').is(':checked'),
                        'empresaId': '{{ app.request.get('id') }}'
                    },
                    dataType: "JSON",
                    success: function (data) {

                        if(data == "OK"){

                            recuperaCnaes();

                            $('#btnAddCnae').prop("disabled", false);
                            $('#btnAddCnae').html("{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}");

                            $('#cnaeValor').val("").change();
                            $('#funcion').val("");

                            new PNotify({
                                title: '{% trans from "messages" %}TRANS_AVISO_AÑADIDO{% endtrans %}',
                                text: '{% trans from "messages" %}TRANS_AVISO_AÑADIDO_MSG{% endtrans %}',
                                icon: 'icon-checkmark3',
                                type: 'success'
                            });

                        }
                    },
                    error: function(){
                        new PNotify({
                            title: 'Ops!',
                            text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                            icon: 'icon-blocked',
                            type: 'error'
                        });

                        $('#btnAddCnae').prop("disabled", false);
                        $('#btnAddCnae').html("{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}");
                    }
                });
            });

            //Boton para editar un cnae
            $('#btnUpdateCnae').click(function(){

                if($('#cnaeValorEditar').val() == ''){
                    $('#cnaeValorEditar').focus();
                    return false;
                }

                $('#btnUpdateCnae').prop("disabled", true);
                $('#btnUpdateCnae').html("<i class=\"icon-spinner2 spinner mr-2\"></i>Guardar");

                $.ajax({
                    type: "POST",
                    url: "{{ path('empresa_update_cnae') }}",
                    data: {
                        'cnaeId': $('#cnaeValorEditar').val(),
                        'principal': $('#principalEditar').is(':checked'),
                        'cnaeEmpresaId': $('#cnaeEmpresaIdEditar').val()
                    },
                    dataType: "JSON",
                    success: function (data) {

                        if(data == "OK"){

                            recuperaCnaes();

                            $('#btnUpdateCnae').prop("disabled", false);
                            $('#btnUpdateCnae').html("Guardar");

                            $('#cnaeValorEditar').val("").change();
                            $('#principalEditar').val("");

                            new PNotify({
                                title: '{% trans from "messages" %}TRANS_AVISO_AÑADIDO{% endtrans %}',
                                text: '{% trans from "messages" %}TRANS_AVISO_AÑADIDO_MSG{% endtrans %}',
                                icon: 'icon-checkmark3',
                                type: 'success'
                            });

                        }
                    },
                    error: function(){
                        new PNotify({
                            title: 'Ops!',
                            text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                            icon: 'icon-blocked',
                            type: 'error'
                        });

                        $('#btnUpdateCnae').prop("disabled", false);
                        $('#btnUpdateCnae').html("Guardar");
                    }
                });
            });

            // Format displayed data
            function formatRepo (repo) {
                if (repo.loading) return repo.text;

                var markup = '<div class="clearfix">' +
                    '<div>' + repo.descripcion + '</div>' +
                    '</div>';

                return markup;
            }

            // Format selection
            function formatRepoSelection (repo) {
                return repo.full_name || repo.text;
            }

            // Initialize
            $('.js_busca_ajax_centro').select2({
                ajax: {
                    url: "{{ path('busca_ajax_query',{ 'option': 'centroTrabajo' }) }}",
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            q: params.term, // search term
                            page: params.page
                        };
                    },
                    processResults: function (data, params) {

                        var select2Data = $.map(JSON.parse(data), function (obj) {
                            obj.id = parseInt(obj.id);
                            obj.text = obj.descripcion;

                            return obj;
                        });

                        return {
                            results: select2Data
                        };
                    },
                    cache: true
                },
                escapeMarkup: function (markup) { return markup; }, // let our custom formatter work
                minimumInputLength: 3,
                templateResult: formatRepo, // omitted for brevity, see the source of this page
                templateSelection: formatRepoSelection // omitted for brevity, see the source of this page
            });

            $('.js_busca_ajax_trabajador').select2({
                ajax: {
                    url: "{{ path('busca_ajax_query',{ 'option': 'trabajadorEmpresa' }) }}",
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            q: params.term, // search term
                            page: params.page
                        };
                    },
                    processResults: function (data, params) {

                        var select2Data = $.map(JSON.parse(data), function (obj) {
                            obj.id = parseInt(obj.id);
                            obj.text = obj.descripcion;

                            return obj;
                        });

                        return {
                            results: select2Data
                        };
                    },
                    cache: true
                },
                escapeMarkup: function (markup) { return markup; }, // let our custom formatter work
                minimumInputLength: 3,
                templateResult: formatRepo, // omitted for brevity, see the source of this page
                templateSelection: formatRepoSelection // omitted for brevity, see the source of this page
            });

            //Boton para añadir un centro de trabajo
            $('#btnAddCentroTrabajoEmpresa').click(function(){

                if($('#centroTrabajo').val() == ''){
                    $('#centroTrabajo').focus();
                    return false;
                }

                $('#btnAddCentroTrabajoEmpresa').prop("disabled", true);
                $('#btnAddCentroTrabajoEmpresa').html("<i class=\"icon-spinner2 spinner mr-2\"></i>{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}");

                $.ajax({
                    type: "POST",
                    url: "{{ path('empresa_add_centro_trabajo_empresa') }}",
                    data: {
                        'centroTrabajoId': $('#centroTrabajo').val(),
                    },
                    dataType: "JSON",
                    success: function (data) {

                        if(data == "OK"){

                            recuperaCentroTrabajo();

                            $('#btnAddCentroTrabajoEmpresa').prop("disabled", false);
                            $('#btnAddCentroTrabajoEmpresa').html("{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}");

                            $('#btnAddCentroTrabajoEmpresa').val("").change();

                            new PNotify({
                                title: '{% trans from "messages" %}TRANS_AVISO_AÑADIDO{% endtrans %}',
                                text: '{% trans from "messages" %}TRANS_AVISO_AÑADIDO_MSG{% endtrans %}',
                                icon: 'icon-checkmark3',
                                type: 'success'
                            });

                        }
                    },
                    error: function(){
                        new PNotify({
                            title: 'Ops!',
                            text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                            icon: 'icon-blocked',
                            type: 'error'
                        });

                        $('#btnAddCentroTrabajoEmpresa').prop("disabled", false);
                        $('#btnAddCentroTrabajoEmpresa').html("{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}");
                    }
                });
            });

            //Boton para añadir un trabajador
            $('#btnAddTrabajador').click(function(){

                if($('#trabajadorEmpresa').val() == ''){
                    $('#trabajadorEmpresa').focus();
                    return false;
                }

                $('#btnAddTrabajador').prop("disabled", true);
                $('#btnAddTrabajador').html("<i class=\"icon-spinner2 spinner mr-2\"></i>{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}");

                $.ajax({
                    type: "POST",
                    url: "{{ path('empresa_add_trabajador_empresa') }}",
                    data: {
                        'trabajadorId': $('#trabajadorEmpresa').val(),
                    },
                    dataType: "JSON",
                    success: function (data) {

                        if(data == "OK"){
                            location.reload();
                        }
                    },
                    error: function(){
                        new PNotify({
                            title: 'Ops!',
                            text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                            icon: 'icon-blocked',
                            type: 'error'
                        });

                        $('#btnAddTrabajador').prop("disabled", false);
                        $('#btnAddTrabajador').html("{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}");
                    }
                });

            });

            //Validación del CIF de empresa
            $('#empresa_medico_cif').focusout(function(){
                var cif = $(this).val();
                if(isValidCif(cif)){
                    $.ajax({
                        type: "POST",
                        url: "{{ path('empresa_comprueba_cif') }}",
                        data: {
                            'cif': cif,
                            'empresaId': '{{ app.request.get('id') }}'
                        },
                        dataType: "JSON",
                        success: function (data) {
                            if(data == "1"){
                                $('#empresa_medico_cif').removeClass('border-success');
                                $('#empresa_medico_cif').addClass('border-danger');
                                $('.incorrectoCif').css('display', 'block');
                                $('.incorrectoCif').html('{% trans %}TRANS_ERROR_CIF_EXISTE{% endtrans %}');
                            }else{
                                $('#empresa_medico_cif').removeClass('border-danger');
                                $('#empresa_medico_cif').addClass('border-success');
                                $('.incorrectoCif').css('display', 'none');
                            }
                        },
                        error: function(){
                            new PNotify({
                                title: 'Ops!',
                                text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                                icon: 'icon-blocked',
                                type: 'error'
                            });
                        }
                    });
                }else{
                    $(this).removeClass('border-success');
                    $(this).addClass('border-danger');
                    $('.incorrectoCif').html('{% trans %}TRANS_ERROR_CIF{% endtrans %}');
                    $('.incorrectoCif').css('display', 'block');
                }

            });

            //Boton para añadir un tecnico
            $('#btnAddTecnico').click(function(){

                if($('#tecnico').val() == ''){
                    $('#tecnico').focus();
                    return false;
                }

                $('#btnAddTecnico').prop("disabled", true);
                $('#btnAddTecnico').html("<i class=\"icon-spinner2 spinner mr-2\"></i>{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}");

                $.ajax({
                    type: "POST",
                    url: "{{ path('empresa_add_tecnico') }}",
                    data: {
                        'tecnicoId': $('#tecnico').val(),
                        'empresaId': '{{ app.request.get('id') }}'
                    },
                    dataType: "JSON",
                    success: function (data) {

                        if(data == "OK"){

                            recuperaTecnicos();

                            $('#btnAddTecnico').prop("disabled", false);
                            $('#btnAddTecnico').html("{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}");

                            $('#tecnico').val("").change();

                            new PNotify({
                                title: '{% trans from "messages" %}TRANS_AVISO_AÑADIDO{% endtrans %}',
                                text: '{% trans from "messages" %}TRANS_AVISO_AÑADIDO_MSG{% endtrans %}',
                                icon: 'icon-checkmark3',
                                type: 'success'
                            });

                        }
                    },
                    error: function(){
                        new PNotify({
                            title: 'Ops!',
                            text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                            icon: 'icon-blocked',
                            type: 'error'
                        });

                        $('#btnAddTecnico').prop("disabled", false);
                        $('#btnAddTecnico').html("{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}");
                    }
                });
            });

            //Boton para editar el tecnico
            $('#btnUpdateTecnico').click(function(){

                if($('#tecnicoEditar').val() == ''){
                    $('#tecnicoEditar').focus();
                    return false;
                }

                $('#btnUpdateTecnico').prop("disabled", true);
                $('#btnUpdateTecnico').html("<i class=\"icon-spinner2 spinner mr-2\"></i>Guardar");

                $.ajax({
                    type: "POST",
                    url: "{{ path('empresa_update_tecnico') }}",
                    data: {
                        'tecnicoId': $('#tecnicoEditar').val(),
                        'tecnicoEmpresaId': $('#tecnicoEmpresaId').val()
                    },
                    dataType: "JSON",
                    success: function (data) {

                        if(data == "OK"){

                            recuperaTecnicos();

                            $('#btnUpdateTecnico').prop("disabled", false);
                            $('#btnUpdateTecnico').html("Guardar");

                            $('#tecnicoEditar').val("").change();

                            new PNotify({
                                title: '{% trans from "messages" %}TRANS_AVISO_AÑADIDO{% endtrans %}',
                                text: '{% trans from "messages" %}TRANS_AVISO_AÑADIDO_MSG{% endtrans %}',
                                icon: 'icon-checkmark3',
                                type: 'success'
                            });

                        }
                    },
                    error: function(){
                        new PNotify({
                            title: 'Ops!',
                            text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                            icon: 'icon-blocked',
                            type: 'error'
                        });

                        $('#btnUpdateTecnico').prop("disabled", false);
                        $('#btnUpdateTecnico').html("Guardar");
                    }
                });
            });

            //Boton para añadir un correo
            $('#btnAddCorreo').click(function(){

                if($('#email').val() == ''){
                    $('#email').focus();
                    return false;
                }

                $('#btnAddCorreo').prop("disabled", true);
                $('#btnAddCorreo').html("<i class=\"icon-spinner2 spinner mr-2\"></i>{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}");

                $.ajax({
                    type: "POST",
                    url: "{{ path('empresa_add_email') }}",
                    data: {
                        'email': $('#email').val(),
                        'funcion': $('#funcion').val(),
                        'empresaId': '{{ app.request.get('id') }}'
                    },
                    dataType: "JSON",
                    success: function (data) {

                        if(data == "OK"){

                            recuperaEmails();

                            $('#btnAddCorreo').prop("disabled", false);
                            $('#btnAddCorreo').html("{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}");

                            $('#email').val("");
                            $('#funcion').val("").change();

                            new PNotify({
                                title: '{% trans from "messages" %}TRANS_AVISO_AÑADIDO{% endtrans %}',
                                text: '{% trans from "messages" %}TRANS_AVISO_AÑADIDO_MSG{% endtrans %}',
                                icon: 'icon-checkmark3',
                                type: 'success'
                            });

                        }
                    },
                    error: function(){
                        new PNotify({
                            title: 'Ops!',
                            text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                            icon: 'icon-blocked',
                            type: 'error'
                        });

                        $('#btnAddCorreo').prop("disabled", false);
                        $('#btnAddCorreo').html("{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}");
                    }
                });
            });

            //Boton para editar el correo
            $('#btnUpdateCorreo').click(function(){

                if($('#emailEditar').val() == ''){
                    $('#emailEditar').focus();
                    return false;
                }

                $('#btnUpdateCorreo').prop("disabled", true);
                $('#btnUpdateCorreo').html("<i class=\"icon-spinner2 spinner mr-2\"></i>Guardar");

                $.ajax({
                    type: "POST",
                    url: "{{ path('empresa_update_email') }}",
                    data: {
                        'email': $('#emailEditar').val(),
                        'funcion': $('#funcionEditar').val(),
                        'correoEmpresaId': $('#correoEmpresaIdEditar').val()
                    },
                    dataType: "JSON",
                    success: function (data) {

                        if(data == "OK"){

                            recuperaEmails();

                            $('#btnUpdateCorreo').prop("disabled", false);
                            $('#btnUpdateCorreo').html("Guardar");

                            $('#emailEditar').val("");
                            $('#funcionEditar').val("").change();

                            new PNotify({
                                title: '{% trans from "messages" %}TRANS_AVISO_AÑADIDO{% endtrans %}',
                                text: '{% trans from "messages" %}TRANS_AVISO_AÑADIDO_MSG{% endtrans %}',
                                icon: 'icon-checkmark3',
                                type: 'success'
                            });

                        }
                    },
                    error: function(){
                        new PNotify({
                            title: 'Ops!',
                            text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                            icon: 'icon-blocked',
                            type: 'error'
                        });

                        $('#btnUpdateCorreo').prop("disabled", false);
                        $('#btnUpdateCorreo').html("Guardar");
                    }
                });
            });

            //Evento que busca la localidad y provincia
            $('#empresa_medico_codigoPostalPostal').focusout(function(){
                $.ajax({
                    type: "POST",
                    url: "{{ path('empresa_busca_localidad_provincia') }}",
                    data: {
                        'codigopostal': $('#empresa_medico_codigoPostalPostal').val(),
                    },
                    dataType: "JSON",
                    success: function (data) {
                        console.log(data);
                        if(data != ""){
                            $('#empresa_medico_localidadPostal').val(data.localidad);
                            $('#empresa_medico_provinciaPostal').val(data.provincia);
                            $('#empresa_medico_provinciaPostalSerpa').val(data.provincia_id).change();
                            $('#empresa_medico_municipioPostalSerpa').val(data.localidad_id).change();
                        }
                    },
                    error: function(){
                        new PNotify({
                            title: 'Ops!',
                            text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                            icon: 'icon-blocked',
                            type: 'error'
                        });
                    }
                });
            });

            //Boton que genera la memoria
            $('#btnGenerarMemoria').click(function(){
                var plantilla = $('#plantillaMemoria').val();

                if(plantilla == ""){
                    $('#plantillaMemoria').focus();
                    return false;
                }
                var year = $('#anyoMemoria').val();
                
                if(year == ""){
                    $('#anyoMemoria').focus();
                    return false;
                }
                $('#btnGenerarMemoria').prop("disabled", true);
                $('#btnGenerarMemoria').html("<i class=\"icon-spinner2 spinner mr-2\"></i>{% trans from 'messages' %}TRANS_IMPRIMIR{% endtrans %}");

                $.ajax({
                    type: "POST",
                    url: "{{ path('gdoc_generar_file') }}",
                    data: {
                        'plantillaId': plantilla,
                        'tipo': 15,
                        'anyo': year
                    },
                    dataType: "JSON",
                    success: function (data) {
                        if(data != ""){

                            $('#btnGenerarMemoria').prop("disabled", false);
                            $('#btnGenerarMemoria').html("{% trans from 'messages' %}TRANS_IMPRIMIR{% endtrans %}");

                            var w = window.open();
                            w.location = data.url;

                            location.reload();
                        }
                    },
                    error: function(){
                        new PNotify({
                            title: 'Ops!',
                            text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                            icon: 'icon-blocked',
                            type: 'error'
                        });
                        $('#btnGenerarMemoria').prop("disabled", false);
                        $('#btnGenerarMemoria').html("{% trans from 'messages' %}TRANS_IMPRIMIR{% endtrans %}");
                    }
                });
            });
            //Boton que genera el estudio
            $('#btnGenerarEstudio').click(function(){

                var plantilla = $('#plantillaEstudio').val();
                if(plantilla == ""){
                    $('#plantillaEstudio').focus();
                    return false;
                }

                var year = $('#anyoEstudio').val();
                if(year == ""){
                    $('#anyoEstudio').focus();
                    return false;
                }

                $('#btnGenerarEstudio').prop("disabled", true);
                $('#btnGenerarEstudio').html("<i class=\"icon-spinner2 spinner mr-2\"></i>{% trans from 'messages' %}TRANS_IMPRIMIR{% endtrans %}");

                $.ajax({
                    type: "POST",
                    url: "{{ path('gdoc_generar_file') }}",
                    data: {
                        'plantillaId': plantilla,
                        'tipo': 16,
                        'anyo': year
                    },
                    dataType: "JSON",
                    success: function (data) {
                        if(data != ""){

                            $('#btnGenerarEstudio').prop("disabled", false);
                            $('#btnGenerarEstudio').html("{% trans from 'messages' %}TRANS_IMPRIMIR{% endtrans %}");

                            var w = window.open();
                            w.location = data.url;

                            location.reload();
                        }
                    },
                    error: function(){
                        new PNotify({
                            title: 'Ops!',
                            text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                            icon: 'icon-blocked',
                            type: 'error'
                        });

                        $('#btnGenerarEstudio').prop("disabled", false);
                        $('#btnGenerarEstudio').html("{% trans from 'messages' %}TRANS_IMPRIMIR{% endtrans %}");
                    }
                });
            });

            //Boton que genera el resumen
            $('#btnResumenRevision').click(function(){

                $('#btnResumenRevision').prop("disabled", true);
                $('#btnResumenRevision').html("<i class=\"icon-spinner2 spinner mr-2\"></i>{% trans from 'messages' %}TRANS_IMPRIMIR{% endtrans %}");

                $.ajax({
                    type: "POST",
                    url: "{{ path('gdoc_generar_file') }}",
                    data: {
                        'plantillaId': $('#plantilla').val(),
                        'id': $('#revisionId').val(),
                        'tipo': 13
                    },
                    dataType: "JSON",
                    success: function (data) {
                        if(data != ""){

                            $('#btnResumenRevision').prop("disabled", false);
                            $('#btnResumenRevision').html("{% trans from 'messages' %}TRANS_IMPRIMIR{% endtrans %}");

                            var w = window.open();
                            w.location = data.url;

                            location.reload();
                        }
                    },
                    error: function(){
                        new PNotify({
                            title: 'Ops!',
                            text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                            icon: 'icon-blocked',
                            type: 'error'
                        });

                        $('#btnResumenRevision').prop("disabled", false);
                        $('#btnResumenRevision').html("{% trans from 'messages' %}TRANS_IMPRIMIR{% endtrans %}");
                    }
                });
            });

            //Boton que genera la aptitud
            $('#btnImprimirAptitud').click(function(){
                var plantilla = $('#plantillaAptitud').val();
                if(plantilla == ""){
                    $('#plantillaAptitud').focus();
                    return false;
                }

                $('#btnImprimirAptitud').prop("disabled", true);
                $('#btnImprimirAptitud').html("<i class=\"icon-spinner2 spinner mr-2\"></i>{% trans from 'messages' %}TRANS_IMPRIMIR{% endtrans %}");

                $.ajax({
                    type: "POST",
                    url: "{{ path('gdoc_generar_file') }}",
                    data: {
                        'plantillaId': plantilla,
                        'id': $('#aptitudId').val(),
                        'tipo': 11
                    },
                    dataType: "JSON",
                    success: function (data) {
                        if(data != ""){

                            $('#btnImprimirAptitud').prop("disabled", false);
                            $('#btnImprimirAptitud').html("{% trans from 'messages' %}TRANS_IMPRIMIR{% endtrans %}");

                            var w = window.open();
                            w.location = data.url;

                            location.reload();
                        }
                    },
                    error: function(){
                        new PNotify({
                            title: 'Ops!',
                            <!--text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',-->
                            text: 'a3',
                            icon: 'icon-blocked',
                            type: 'error'
                        });

                        $('#btnImprimirAptitud').prop("disabled", false);
                        $('#btnImprimirAptitud').html("{% trans from 'messages' %}TRANS_IMPRIMIR{% endtrans %}");
                    }
                });
            });

            var xhr;
            var json = {{ tree | raw }};
            var selected_id;

            function ControlViews() {
                selected_id = $("#tree").find(".jstree-clicked").attr('id');
                //Algun nodo selecionado.
                if (typeof selected_id != 'undefined' && selected_id != '') {
                    var remove = /_anchor$/;
                    selected_id = selected_id.replace(remove, "");
                    //FICHERO
                    if (selected_id.indexOf("fileId") == 0) {
                        selected_id = selected_id.replace("fileId", "");
                        plantillaAjaxRequest(selected_id);
                    }
                }
            }

            $(function () {
                $("#tree")
                    .jstree({
                        'core': {
                            'data': json,
                            'check_callback': true
                        },

                        'plugins': ["search", "sort", "state"]

                    })
                    .on('changed.jstree', function (e, data) {
                        if (xhr && xhr.readyState != 4) {
                            xhr.abort();
                        }
                        ControlViews();
                    })
                    .on('ready.jstree', function (e, data) {
                        var fileUploadedID = location.search.split('fileid=')[1];
                        //console.log(fileUploadedID);
                        if (typeof(fileUploadedID) != "undefined") {
                            var node = "fileId" + fileUploadedID;
                            $('#tree').jstree('deselect_all');
                            setTimeout(function(){
                                $('#tree').jstree('select_node', node);
                            },300);

                        }
                    });
            });

            ControlViews();

            //Evento click carpeta
            $('#tree').on("select_node.jstree", function (e, data) {
                var carpetaId = data.node['id'];
                var modificarSn = data.node['modificar'];
                if(carpetaId != "" && !isNaN(carpetaId) && modificarSn){
                    $.ajax({
                        type: 'POST',
                        url: '{{ path('gdoc_recupera_carpeta') }}',
                        data: {
                            'id': carpetaId,
                            'tipo': 3
                        },
                        dataType: 'json',
                        success: function (response) {
                            $("#idCarpeta").val(response.id);
                            $("#nombreCarpetaEditar").val(response.nombre);
                            $("#carpetaPadreEditar").val(response.padre).change();
                            $('#modal_editar_carpeta').modal('show');
                        }
                    });
                }
            });

            function plantillaAjaxRequest(plantillaId) {

                $("#nombreFichero").val("");
                $("#fechaFichero").val("");
                $("#usuarioFichero").val("");
                $("#tipoFichero").val("");
                $("#midaFichero").val("");
                $("#idFichero").val("");
                $("#btnDownPlantilla").attr('href', "");
                $("#btnOpenPlantilla").attr('href', "");

                $('#modal_view_fichero').modal('show');

                var url = '{{ path('gdoc_plantilla_view') }}';

                $("#btnOpenPlantilla").hide();
                $("#btnDownPlantilla").hide();
                $('#btnDeletePlantilla').hide();

                var empresaId = '{{ app.request.get('id') }}';

                xhr = $.ajax({
                    type: 'POST',
                    url: url,
                    data: {
                        'id': plantillaId,
                        'tipo': 3,
                        'empresaId': '{{ app.request.get('id') }}'
                    },
                    dataType: 'json',
                    success: function (response) {
                        $("#nombreFichero").val(response.name);
                        $("#fechaFichero").val(response.fecha);
                        $("#usuarioFichero").val(response.usuario);
                        $("#tipoFichero").val(response.tipo);
                        $("#midaFichero").val(response.mida);
                        $("#idFichero").val(response.id);
                        $("#btnDownPlantilla").attr('href', '{{ path('gdoc_down_plantilla') }}?plantillaId='+response.down+'&tipo=3&empresaId='+empresaId);
                        $("#btnOpenPlantilla").attr('href', '{{ path('gdoc_open_plantilla') }}?plantillaId='+response.open+'&tipo=3&empresaId='+empresaId);

                        $("#btnDownPlantilla").show();
                        $("#btnOpenPlantilla").show();
                        $('#btnDeletePlantilla').show();
                    }
                });
            }

            //Boton que elimina el fichero seleccionado
            $('#btnDeletePlantilla').click(function(){

                $('#btnDeletePlantilla').prop("disabled", true);
                $('#btnDeletePlantilla').html("<i class=\"icon-spinner2 spinner mr-2\"></i>{% trans from 'messages' %}TRANS_ELIMINAR{% endtrans %}");

                $.ajax({
                    type: "POST",
                    url: "{{ path('gdoc_plantilla_delete') }}",
                    data: {
                        'id': $('#idFichero').val(),
                        'tipo': 3
                    },
                    dataType: "JSON",
                    success: function (data) {

                        if(data == "OK"){

                            $('#btnDeletePlantilla').prop("disabled", false);
                            $('#btnDeletePlantilla').html("{% trans from 'messages' %}TRANS_ELIMINAR{% endtrans %}");

                            new PNotify({
                                title: '{% trans from "messages" %}TRANS_AVISO_ELIMINADO{% endtrans %}',
                                text: '{% trans from "messages" %}TRANS_AVISO_ELIMINADO_MSG{% endtrans %}',
                                icon: 'icon-checkmark3',
                                type: 'success'
                            });

                            setTimeout(function() {
                                location.reload();
                            }, 2000);

                        }
                    },
                    error: function(){
                        new PNotify({
                            title: 'Ops!',
                            text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                            icon: 'icon-blocked',
                            type: 'error'
                        });

                        $('#btnDeletePlantilla').prop("disabled", false);
                        $('#btnDeletePlantilla').html("{% trans from 'messages' %}TRANS_ELIMINAR{% endtrans %}");
                    }
                });

            });

            //Botón que añade la nueva carpeta
            $('#btnAddCarpeta').click(function(){

                var nombreCarpeta = $('#nombreCarpeta').val();
                var carpetaPadre = $('#carpetaPadre').val();

                if(nombreCarpeta == "" || nombreCarpeta == null){
                    $('#nombreCarpeta').focus();
                    return false;
                }

                $('#btnAddCarpeta').prop("disabled", true);
                $('#btnAddCarpeta').html("<i class=\"icon-spinner2 spinner mr-2\"></i>{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}");

                $.ajax({
                    type: "POST",
                    url: "{{ path('gdoc_carpeta_add') }}",
                    data: {
                        'nombre': nombreCarpeta,
                        'padre': carpetaPadre,
                        'tipo': 3,
                        'empresaId': '{{ app.request.get('id') }}'
                    },
                    dataType: "JSON",
                    success: function (data) {
                        if(data == "OK"){
                            location.reload();
                        }
                    },
                    error: function(){
                        new PNotify({
                            title: 'Ops!',
                            text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                            icon: 'icon-blocked',
                            type: 'error'
                        });

                        $('#btnAddCarpeta').prop("disabled", false);
                        $('#btnAddCarpeta').html("{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}");
                    }
                });
            });

            //Botón que modifica la carpeta seleccionada
            $('#btnUpdateCarpeta').click(function(){

                var nombreCarpeta = $('#nombreCarpetaEditar').val();
                var carpetaPadre = $('#carpetaPadreEditar').val();
                var id = $('#idCarpeta').val();

                if(nombreCarpeta == "" || nombreCarpeta == null){
                    $('#nombreCarpetaEditar').focus();
                    return false;
                }

                $('#btnUpdateCarpeta').prop("disabled", true);
                $('#btnUpdateCarpeta').html("<i class=\"icon-spinner2 spinner mr-2\"></i>Guardar");

                $.ajax({
                    type: "POST",
                    url: "{{ path('gdoc_carpeta_update') }}",
                    data: {
                        'id': id,
                        'nombre': nombreCarpeta,
                        'padre': carpetaPadre,
                        'tipo': 3,
                    },
                    dataType: "JSON",
                    success: function (data) {
                        if(data == "OK"){
                            location.reload();
                        }
                    },
                    error: function(){
                        new PNotify({
                            title: 'Ops!',
                            text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                            icon: 'icon-blocked',
                            type: 'error'
                        });

                        $('#btnUpdateCarpeta').prop("disabled", false);
                        $('#btnUpdateCarpeta').html("Guardar");
                    }
                });
            });

            //Botón que modifica la carpeta seleccionada
            $('#btnDeleteCarpeta').click(function(){

                var id = $('#idCarpeta').val();

                $('#btnDeleteCarpeta').prop("disabled", true);
                $('#btnDeleteCarpeta').html("<i class=\"icon-spinner2 spinner mr-2\"></i>Eliminar");

                $.ajax({
                    type: "POST",
                    url: "{{ path('gdoc_carpeta_delete') }}",
                    data: {
                        'id': id,
                        'tipo': 3
                    },
                    dataType: "JSON",
                    success: function (data) {
                        if(data == "OK"){
                            location.reload();
                        }
                    },
                    error: function(){
                        new PNotify({
                            title: 'Ops!',
                            text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                            icon: 'icon-blocked',
                            type: 'error'
                        });

                        $('#btnUpdateCarpeta').prop("disabled", false);
                        $('#btnUpdateCarpeta').html("Guardar");
                    }
                });
            });

        });

        //Boton que añade el id de la revision para su generacion
        $(document).on('click', 'a.selectRevision', function(){
            var revisionId = $(this).data('id');
            $('#revisionId').val(revisionId);
        });

        //Boton que añade el id de la revision para su generacion
        $(document).on('click', 'a.selectAptitud', function(){
            var revisionId = $(this).data('id');
            $('#aptitudId').val(revisionId);
        });

        //Boton que elimina el fichero seleccionado
        $(document).on('click', 'a.eliminarAptitud', function(){
            var fileId = $(this).data('id');
            bootbox.confirm({
                title: '{% trans from 'messages' %}TRANS_ELIMINAR_FICHERO{% endtrans %}',
                message: '{% trans from 'messages' %}TRANS_CONFIRM_DELETE_REGISTRO{% endtrans %}',
                buttons: {
                    confirm: {
                        label: 'Si',
                        className: 'btn-primary'
                    },
                    cancel: {
                        label: 'No',
                        className: 'btn-link'
                    }
                },
                callback: function (result) {
                    if(result == true){
                        deleteFichero(fileId,11)
                    }
                }
            });
        });

        //Boton que elimina el fichero seleccionado
        $(document).on('click', 'a.eliminarResumen', function(){
            var fileId = $(this).data('id');
            bootbox.confirm({
                title: '{% trans from 'messages' %}TRANS_ELIMINAR_FICHERO{% endtrans %}',
                message: '{% trans from 'messages' %}TRANS_CONFIRM_DELETE_REGISTRO{% endtrans %}',
                buttons: {
                    confirm: {
                        label: 'Si',
                        className: 'btn-primary'
                    },
                    cancel: {
                        label: 'No',
                        className: 'btn-link'
                    }
                },
                callback: function (result) {
                    if(result == true){
                        deleteFichero(fileId,13)
                    }
                }
            });
        });

        function recuperaCnaes(){
            $.ajax({
                type: "POST",
                url: "{{ path('empresa_recupera_cnaes') }}",
                data: {
                    'empresaId': '{{ app.request.get('id') }}'
                },
                dataType: "JSON",
                beforeSend: function(data){
                    $("#cnae").block({
                        message: '<i class="icon-spinner2 spinner"></i>',
                        overlayCSS: {
                            backgroundColor: '#fff',
                            opacity: 0.8,
                            cursor: 'wait'
                        },
                        css: {
                            border: 0,
                            padding: 0,
                            backgroundColor: 'none'
                        }
                    });
                },
                success: function (data) {

                    var table = '<thead><tr class="bg-grey-300"><th>{% trans from 'empresas' %}TRANS_PRINCIPAL_CNAE{% endtrans %}</th><th>{% trans from 'empresas' %}TRANS_CODIGO_CNAE{% endtrans %}</th><th>{% trans from 'empresas' %}TRANS_DESCRIPCION_CNAE{% endtrans %}</th><th>{% trans from 'messages' %}TRANS_ACCIONES{% endtrans %}</th></tr></thead>';

                    table += "<tbody>";

                    if(JSON.parse(data) != ""){
                        var item = 1;

                        $.each(JSON.parse(data), function (key, item) {

                            if (item % 2 == 0) {
                                 table += '<tr class="grid-row-cells odd"> ';
                             }
                             else {
                                 table += '<tr  class="grid-row-cells even"> ';
                             }

                            if (item["principal"] != undefined) {
                                if(item["principal"] == true){
                                    table += '<td><span class="badge badge-flat border-success text-success-600"><i class="icon-checkmark2"></i></span></td>';
                                }else{
                                    table += '<td><span class="badge badge-flat border-danger text-danger-600"><i class="icon-cross3"></i></span></td>';
                                }
                            }
                            else {
                                table += '<td></td>';
                            }

                            if (item["cnae"] != undefined) {
                                table += '<td>' + item["cnae"]+ '</td>';
                            }
                            else {
                                table += '<td></td>';
                            }

                            if (item["descripcion"] != undefined) {
                                table += '<td>' + item["descripcion"]+ '</td>';
                            }
                            else {
                                table += '<td></td>';
                            }

                            if (item["id"] != undefined) {
                                table += '<td><div class="list-icons">';

                                {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                                    {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                                        table += '<a href="#" data-id="' + item["id"]+ '" target="_self" class="list-icons-item" onclick="recuperaCnae('+ item["id"]+');" data-toggle="modal" data-target="#modal_editar_cnae"><i class="icon-pencil7"></i></a>';
                                        table += '<a href="#" data-id="' + item["id"]+ '" target="_self" class="list-icons-item eliminarCnae"><i class="icon-trash"></i></a>';
                                    {% endif %}
                                {% endif %}

                                table += '</div></td>';
                            }
                            else {
                                table += '<td></td>';
                            }

                            item++;

                            table += '</tr>';
                        });

                    }else{
                        table += "<tr><td colspan='2' align='center'>{% trans from 'messages' %}TRANS_SIN_REGISTROS{% endtrans %}</td></tr>";
                    }

                    table += "</tbody>";

                    $("#cnae").html("");
                    $("#cnae").html(table);

                },
                error: function(){
                    new PNotify({
                        title: 'Ops!',
                        text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                        icon: 'icon-blocked',
                        type: 'error'
                    });
                }
            });
        }

        function recuperaCentroTrabajo(){
            $.ajax({
                type: "POST",
                url: "{{ path('empresa_recupera_centro_trabajo_empresa') }}",
                data: {
                    'empresaId': '{{ app.request.get('id') }}'
                },
                dataType: "JSON",
                beforeSend: function(data){
                    $("#centroTrabajoEmpresa").block({
                        message: '<i class="icon-spinner2 spinner"></i>',
                        overlayCSS: {
                            backgroundColor: '#fff',
                            opacity: 0.8,
                            cursor: 'wait'
                        },
                        css: {
                            border: 0,
                            padding: 0,
                            backgroundColor: 'none'
                        }
                    });
                },
                success: function (data) {

                    var table = '<thead><tr class="bg-grey-300"><th>{% trans from 'empresas' %}TRANS_NOMBRE{% endtrans %}</th><th>{% trans from 'messages' %}TRANS_ACCIONES{% endtrans %}</th></tr></thead>';

                    table += "<tbody>";

                    if(JSON.parse(data) != ""){
                        var item = 1;

                        $.each(JSON.parse(data), function (key, item) {

                            if (item % 2 == 0) {
                                 table += '<tr class="grid-row-cells odd"> ';
                             }
                             else {
                                 table += '<tr  class="grid-row-cells even"> ';
                             }

                            if (item["nombre"] != undefined) {
                                table += '<td>' + item["nombre"]+ '</td>';
                            }
                            else {
                                table += '<td></td>';
                            }

                            if (item["id"] != undefined) {
                                table += '<td><div class="list-icons">';

                                {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                                    {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                                        table += '<a href="#" data-id="' + item["id"]+ '" target="_self" class="list-icons-item eliminarCentroTrabajo"><i class="icon-trash"></i></a>';
                                    {% endif %}
                                {% endif %}

                                table += '</div></td>';
                            }
                            else {
                                table += '<td></td>';
                            }

                            item++;

                            table += '</tr>';
                        });

                    }else{
                        table += "<tr><td colspan='2' align='center'>{% trans from 'messages' %}TRANS_SIN_REGISTROS{% endtrans %}</td></tr>";
                    }

                    table += "</tbody>";

                    $("#centroTrabajoEmpresa").html("");
                    $("#centroTrabajoEmpresa").html(table);

                },
                error: function(){
                    new PNotify({
                        title: 'Ops!',
                        text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                        icon: 'icon-blocked',
                        type: 'error'
                    });
                }
            });
        }

        function recuperaCnae(id) {
            $.ajax({
                type: "POST",
                url: "{{ path('empresa_recupera_cnae') }}",
                data: {
                    'cnaeEmpresaId': id
                },
                dataType: "JSON",
                success: function (data) {
                    if (data != null) {
                        $('#cnaeValorEditar').val(data.cnaeId).change();
                        $('#cnaeEmpresaIdEditar').val(data.id);

                        if(data.principal == true){
                            $('#uniform-principalEditar span').addClass('checked');
                            $('#principalEditar').attr("checked", "checked");
                        }else{
                            $('#uniform-principalEditar span').removeClass('checked');
                        }

                    }
                },
                error: function () {
                    new PNotify({
                        title: 'Ops!',
                        text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                        icon: 'icon-blocked',
                        type: 'error'
                    });
                }
            });
        }

        function deleteCnae(id) {
            $.ajax({
                type: "POST",
                url: "{{ path('empresa_delete_cnae') }}",
                data: {
                    'cnaeEmpresaId': id
                },
                dataType: "JSON",
                success: function (data) {
                    if (data == "OK") {

                        recuperaCnaes();

                        new PNotify({
                            title: '{% trans from "messages" %}TRANS_AVISO_ELIMINADO{% endtrans %}',
                            text: '{% trans from "messages" %}TRANS_AVISO_ELIMINADO_MSG{% endtrans %}',
                            icon: 'icon-checkmark3',
                            type: 'success'
                        });
                    }
                },
                error: function () {
                    new PNotify({
                        title: 'Ops!',
                        text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                        icon: 'icon-blocked',
                        type: 'error'
                    });
                }
            });
        }

        function deleteTrabajadorEmpresa(id) {
            $.ajax({
                type: "POST",
                url: "{{ path('empresa_delete_trabajador_empresa') }}",
                data: {
                    'trabajadorEmpresaId': id
                },
                dataType: "JSON",
                success: function (data) {
                    if (data == "OK") {
                        location.reload();
                    }
                },
                error: function () {
                    new PNotify({
                        title: 'Ops!',
                        text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                        icon: 'icon-blocked',
                        type: 'error'
                    });
                }
            });
        }

        function deleteCentroTrabajo(id) {
            $.ajax({
                type: "POST",
                url: "{{ path('empresa_delete_centro_trabajo_empresa') }}",
                data: {
                    'centroEmpresaId': id
                },
                dataType: "JSON",
                success: function (data) {
                    if (data == "OK") {
                        recuperaCentroTrabajo();

                        new PNotify({
                            title: '{% trans from "messages" %}TRANS_AVISO_ELIMINADO{% endtrans %}',
                            text: '{% trans from "messages" %}TRANS_AVISO_ELIMINADO_MSG{% endtrans %}',
                            icon: 'icon-checkmark3',
                            type: 'success'
                        });
                    }
                },
                error: function () {
                    new PNotify({
                        title: 'Ops!',
                        text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                        icon: 'icon-blocked',
                        type: 'error'
                    });
                }
            });
        }

        $(document).on('click', 'a.eliminarCnae', function(){
            var id = $(this).data('id');

            bootbox.confirm({
                title: '{% trans from 'messages' %}TRANS_ELIMINAR_CNAE{% endtrans %}',
                message: '{% trans from 'messages' %}TRANS_CONFIRM_DELETE_REGISTRO{% endtrans %}',
                buttons: {
                    confirm: {
                        label: 'Si',
                        className: 'btn-primary'
                    },
                    cancel: {
                        label: 'No',
                        className: 'btn-link'
                    }
                },
                callback: function (result) {
                    if(result == true){
                        deleteCnae(id)
                    }
                }
            });
        });

        $(document).on('click', 'a.eliminarTrabajador', function(){
            var id = $(this).data('id');

            bootbox.confirm({
                title: '{% trans from 'messages' %}TRANS_ELIMINAR_TRABAJADOR{% endtrans %}',
                message: '{% trans from 'messages' %}TRANS_CONFIRM_DELETE_REGISTRO{% endtrans %}',
                buttons: {
                    confirm: {
                        label: 'Si',
                        className: 'btn-primary'
                    },
                    cancel: {
                        label: 'No',
                        className: 'btn-link'
                    }
                },
                callback: function (result) {
                    if(result == true){
                        deleteTrabajadorEmpresa(id)
                    }
                }
            });
        });

        $(document).on('click', 'a.eliminarCentroTrabajo', function(){
            var id = $(this).data('id');

            bootbox.confirm({
                title: '{% trans from 'messages' %}TRANS_ELIMINAR_CENTRO{% endtrans %}',
                message: '{% trans from 'messages' %}TRANS_CONFIRM_DELETE_REGISTRO{% endtrans %}',
                buttons: {
                    confirm: {
                        label: 'Si',
                        className: 'btn-primary'
                    },
                    cancel: {
                        label: 'No',
                        className: 'btn-link'
                    }
                },
                callback: function (result) {
                    if(result == true){
                        deleteCentroTrabajo(id)
                    }
                }
            });
        });

        function isValidCif(cif) {
            if (!cif || cif.length !== 9) {
                return false;
            }

            var letters = ['J', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I'];
            var digits = cif.substr(1, cif.length - 2);
            var letter = cif.substr(0, 1);
            var control = cif.substr(cif.length - 1);
            var sum = 0;
            var i;
            var digit;

            if (!letter.match(/[A-Z]/)) {
                return false;
            }

            for (i = 0; i < digits.length; ++i) {
                digit = parseInt(digits[i]);

                if (isNaN(digit)) {
                    return false;
                }

                if (i % 2 === 0) {
                    digit *= 2;
                    if (digit > 9) {
                        digit = parseInt(digit / 10) + (digit % 10);
                    }

                    sum += digit;
                } else {
                    sum += digit;
                }
            }

            sum %= 10;
            if (sum !== 0) {
                digit = 10 - sum;
            } else {
                digit = sum;
            }

            if (letter.match(/[ABEH]/)) {
                return String(digit) === control;
            }
            if (letter.match(/[NPQRSW]/)) {
                return letters[digit] === control;
            }

            return String(digit) === control || letters[digit] === control;
        }

        function recuperaEmails(){
            $.ajax({
                type: "POST",
                url: "{{ path('empresa_recupera_emails') }}",
                data: {
                    'empresaId': '{{ app.request.get('id') }}'
                },
                dataType: "JSON",
                beforeSend: function(data){
                    $("#correos").block({
                        message: '<i class="icon-spinner2 spinner"></i>',
                        overlayCSS: {
                            backgroundColor: '#fff',
                            opacity: 0.8,
                            cursor: 'wait'
                        },
                        css: {
                            border: 0,
                            padding: 0,
                            backgroundColor: 'none'
                        }
                    });
                },
                success: function (data) {

                    var table = '<thead><tr class="bg-grey-300"><th>{% trans from 'empresas' %}TRANS_EMAIL{% endtrans %}</th><th>{% trans from 'empresas' %}TRANS_FUNCION_EMAIL{% endtrans %}</th><th>{% trans from 'messages' %}TRANS_ACCIONES{% endtrans %}</th></tr></thead>';

                    table += "<tbody>";

                    if(JSON.parse(data) != ""){
                        var item = 1;

                        $.each(JSON.parse(data), function (key, item) {

                            if (item % 2 == 0) {
                                 table += '<tr class="grid-row-cells odd"> ';
                             }
                             else {
                                 table += '<tr  class="grid-row-cells even"> ';
                             }

                            if (item["correo"] != undefined) {
                                table += '<td>' + item["correo"]+ '</td>';
                            }
                            else {
                                table += '<td></td>';
                            }

                            if (item["funcion"] != undefined) {
                                table += '<td>' + item["funcion"]+ '</td>';
                            }
                            else {
                                table += '<td></td>';
                            }

                            if (item["id"] != undefined) {
                                table += '<td><div class="list-icons">';

                                {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                                    {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                                        table += '<a href="#" data-id="' + item["id"]+ '" target="_self" class="list-icons-item" onclick="recuperaEmail('+ item["id"]+');" data-toggle="modal" data-target="#modal_editar_email"><i class="icon-pencil7"></i></a>';
                                        table += '<a href="#" data-id="' + item["id"]+ '" target="_self" class="list-icons-item eliminarEmail"><i class="icon-trash"></i></a>';
                                    {% endif %}
                                {% endif %}

                                table += '</div></td>';
                            }
                            else {
                                table += '<td></td>';
                            }

                            item++;

                            table += '</tr>';
                        });

                    }else{
                        table += "<tr><td colspan='3' align='center'>{% trans from 'messages' %}TRANS_SIN_REGISTROS{% endtrans %}</td></tr>";
                    }

                    table += "</tbody>";

                    $("#correos").html("");
                    $("#correos").html(table);

                },
                error: function(){
                    new PNotify({
                        title: 'Ops!',
                        text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                        icon: 'icon-blocked',
                        type: 'error'
                    });
                }
            });
        }

        function recuperaEmail(id) {
            $.ajax({
                type: "POST",
                url: "{{ path('empresa_recupera_email') }}",
                data: {
                    'correoEmpresaId': id
                },
                dataType: "JSON",
                success: function (data) {
                    if (data != null) {
                        $('#emailEditar').val(data.email);
                        $('#funcionEditar').val(data.funcion).change();
                        $('#correoEmpresaIdEditar').val(data.id);
                    }
                },
                error: function () {
                    new PNotify({
                        title: 'Ops!',
                        text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                        icon: 'icon-blocked',
                        type: 'error'
                    });
                }
            });
        }

        function deleteEmail(id) {
            $.ajax({
                type: "POST",
                url: "{{ path('empresa_delete_email') }}",
                data: {
                    'correoEmpresaId': id
                },
                dataType: "JSON",
                success: function (data) {
                    if (data == "OK") {

                        recuperaEmails();

                        new PNotify({
                            title: '{% trans from "messages" %}TRANS_AVISO_ELIMINADO{% endtrans %}',
                            text: '{% trans from "messages" %}TRANS_AVISO_ELIMINADO_MSG{% endtrans %}',
                            icon: 'icon-checkmark3',
                            type: 'success'
                        });
                    }
                },
                error: function () {
                    new PNotify({
                        title: 'Ops!',
                        text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                        icon: 'icon-blocked',
                        type: 'error'
                    });
                }
            });
        }

        $(document).on('click', 'a.eliminarEmail', function(){
            var id = $(this).data('id');

            bootbox.confirm({
                title: '{% trans from 'messages' %}TRANS_ELIMINAR_EMAIL{% endtrans %}',
                message: '{% trans from 'messages' %}TRANS_CONFIRM_DELETE_REGISTRO{% endtrans %}',
                buttons: {
                    confirm: {
                        label: 'Si',
                        className: 'btn-primary'
                    },
                    cancel: {
                        label: 'No',
                        className: 'btn-link'
                    }
                },
                callback: function (result) {
                    if(result == true){
                        deleteEmail(id)
                    }
                }
            });
        });

        function recuperaTecnicos(){
            $.ajax({
                type: "POST",
                url: "{{ path('empresa_recupera_tecnicos') }}",
                data: {
                    'empresaId': '{{ app.request.get('id') }}'
                },
                dataType: "JSON",
                beforeSend: function(data){
                    $("#tecnicos").block({
                        message: '<i class="icon-spinner2 spinner"></i>',
                        overlayCSS: {
                            backgroundColor: '#fff',
                            opacity: 0.8,
                            cursor: 'wait'
                        },
                        css: {
                            border: 0,
                            padding: 0,
                            backgroundColor: 'none'
                        }
                    });
                },
                success: function (data) {

                    var table = '<thead><tr class="bg-grey-300"><th>{% trans from 'empresas' %}TRANS_TECNICO{% endtrans %}</th><th>{% trans from 'messages' %}TRANS_ACCIONES{% endtrans %}</th></tr></thead>';

                    table += "<tbody>";

                    if(JSON.parse(data) != ""){
                        var item = 1;

                        $.each(JSON.parse(data), function (key, item) {

                            if (item % 2 == 0) {
                                table += '<tr class="grid-row-cells odd"> ';
                            }
                            else {
                                table += '<tr  class="grid-row-cells even"> ';
                            }

                            if (item["nombre"] != undefined) {
                                table += '<td>' + item["nombre"]+ '</td>';
                            }
                            else {
                                table += '<td></td>';
                            }

                            if (item["id"] != undefined) {
                                table += '<td><div class="list-icons">';

                                {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                                {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                                table += '<a href="#" data-id="' + item["id"]+ '" target="_self" class="list-icons-item" onclick="recuperaTecnico('+ item["id"]+');" data-toggle="modal" data-target="#modal_editar_tecnico"><i class="icon-pencil7"></i></a>';
                                table += '<a href="#" data-id="' + item["id"]+ '" target="_self" class="list-icons-item eliminarTecnico"><i class="icon-trash"></i></a>';
                                {% endif %}
                                {% endif %}

                                table += '</div></td>';
                            }
                            else {
                                table += '<td></td>';
                            }

                            item++;

                            table += '</tr>';
                        });

                    }else{
                        table += "<tr><td colspan='2' align='center'>{% trans from 'messages' %}TRANS_SIN_REGISTROS{% endtrans %}</td></tr>";
                    }

                    table += "</tbody>";

                    $("#tecnicos").html("");
                    $("#tecnicos").html(table);

                },
                error: function(){
                    new PNotify({
                        title: 'Ops!',
                        text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                        icon: 'icon-blocked',
                        type: 'error'
                    });
                }
            });
        }

        function recuperaTecnico(id) {
            $.ajax({
                type: "POST",
                url: "{{ path('empresa_recupera_tecnico') }}",
                data: {
                    'tecnicoEmpresaId': id
                },
                dataType: "JSON",
                success: function (data) {
                    if (data != null) {
                        $('#tecnicoEditar').val(data.tecnico).change();
                        $('#tecnicoEmpresaId').val(data.id);
                    }
                },
                error: function () {
                    new PNotify({
                        title: 'Ops!',
                        text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                        icon: 'icon-blocked',
                        type: 'error'
                    });
                }
            });
        }

        function deleteTecnico(id) {
            $.ajax({
                type: "POST",
                url: "{{ path('empresa_delete_tecnico') }}",
                data: {
                    'tecnicoEmpresaId': id
                },
                dataType: "JSON",
                success: function (data) {
                    if (data == "OK") {

                        recuperaTecnicos();

                        new PNotify({
                            title: '{% trans from "messages" %}TRANS_AVISO_ELIMINADO{% endtrans %}',
                            text: '{% trans from "messages" %}TRANS_AVISO_ELIMINADO_MSG{% endtrans %}',
                            icon: 'icon-checkmark3',
                            type: 'success'
                        });
                    }
                },
                error: function () {
                    new PNotify({
                        title: 'Ops!',
                        text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                        icon: 'icon-blocked',
                        type: 'error'
                    });
                }
            });
        }

        $(document).on('click', 'a.eliminarTecnico', function(){
            var id = $(this).data('id');

            bootbox.confirm({
                title: '{% trans from 'messages' %}TRANS_ELIMINAR_TECNICO{% endtrans %}',
                message: '{% trans from 'messages' %}TRANS_CONFIRM_DELETE_REGISTRO{% endtrans %}',
                buttons: {
                    confirm: {
                        label: 'Si',
                        className: 'btn-primary'
                    },
                    cancel: {
                        label: 'No',
                        className: 'btn-link'
                    }
                },
                callback: function (result) {
                    if(result == true){
                        deleteTecnico(id)
                    }
                }
            });
        });

        //Boton que elimina el fichero seleccionado
        $(document).on('click', 'a.eliminarMemoria', function(){
            var fileId = $(this).data('id');
            bootbox.confirm({
                title: '{% trans from 'messages' %}TRANS_ELIMINAR_FICHERO{% endtrans %}',
                message: '{% trans from 'messages' %}TRANS_CONFIRM_DELETE_REGISTRO{% endtrans %}',
                buttons: {
                    confirm: {
                        label: 'Si',
                        className: 'btn-primary'
                    },
                    cancel: {
                        label: 'No',
                        className: 'btn-link'
                    }
                },
                callback: function (result) {
                    if(result == true){
                        deleteFichero(fileId,15)
                    }
                }
            });
        });

        //Boton que elimina el fichero seleccionado
        $(document).on('click', 'a.eliminarEstudio', function(){
            var fileId = $(this).data('id');
            bootbox.confirm({
                title: '{% trans from 'messages' %}TRANS_ELIMINAR_FICHERO{% endtrans %}',
                message: '{% trans from 'messages' %}TRANS_CONFIRM_DELETE_REGISTRO{% endtrans %}',
                buttons: {
                    confirm: {
                        label: 'Si',
                        className: 'btn-primary'
                    },
                    cancel: {
                        label: 'No',
                        className: 'btn-link'
                    }
                },
                callback: function (result) {
                    if(result == true){
                        deleteFichero(fileId,16)
                    }
                }
            });
        });

        function deleteFichero(id, tipo) {
            $.ajax({
                type: "POST",
                url: "{{ path('gdoc_delete_file') }}",
                data: {
                    'id': id,
                    'tipo': tipo
                },
                dataType: "JSON",
                success: function (data) {
                    if (data == "OK") {
                        location.reload();
                    }
                },
                error: function () {
                    new PNotify({
                        title: 'Ops!',
                        text: '{% trans from "messages" %}TRANS_AVISO_ERROR{% endtrans %}',
                        icon: 'icon-blocked',
                        type: 'error'
                    });
                }
            });
        }

    </script>

    {% for message in app.flashes('success') %}
        <div class="alert alert-success bg-white alert-styled-left alert-arrow-left alert-dismissible">
            <button type="button" class="close" data-dismiss="alert"><span>×</span></button>
            {{ message }}
        </div>
    {% endfor %}

    <div class="card">
        <div class="card-body">

            {{ form_start(form) }}

            <ul class="nav nav-tabs nav-tabs-highlight">

                {% if (app.request.get('id') is defined and app.request.get('id') is not empty ) %}
                    <li class="nav-item"><a href="#tab1" class="nav-link active" data-toggle="tab">{% trans %}TRANS_MENU_1{% endtrans %}</a></li>
                    <li class="nav-item"><a href="#tab2" class="nav-link" data-toggle="tab">{% trans %}TRANS_MENU_15{% endtrans %}</a></li>
                    <li class="nav-item"><a href="#tab3" class="nav-link" data-toggle="tab">{% trans %}TRANS_MENU_5{% endtrans %}</a></li>
                    <li class="nav-item"><a href="#tab4" class="nav-link" data-toggle="tab">{% trans %}TRANS_MENU_6{% endtrans %}</a></li>
                    <li class="nav-item"><a href="#tab5" class="nav-link" data-toggle="tab">{% trans %}TRANS_MENU_7{% endtrans %}</a></li>
                    <li class="nav-item"><a href="#tab6" class="nav-link" data-toggle="tab">{% trans %}TRANS_MENU_16{% endtrans %}</a></li>
                    <li class="nav-item"><a href="#tab7" class="nav-link" data-toggle="tab">{% trans %}TRANS_MENU_17{% endtrans %}</a></li>
                    <li class="nav-item"><a href="#tab8" class="nav-link" data-toggle="tab">{% trans from 'revision' %}TRANS_REVISIONES{% endtrans %}</a></li>
                    <li class="nav-item"><a href="#tab9" class="nav-link" data-toggle="tab">{% trans %}TRANS_GESTION_DOCUMENTAL{% endtrans %}</a></li>
                {% else %}
                    <li class="nav-item"><a href="#tab1" class="nav-link active" data-toggle="tab">{% trans %}TRANS_MENU_1{% endtrans %}</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" onclick="alert('{% trans from "messages" %}TRANS_MSG_GUARDAR_ANTES{% endtrans %}');">{% trans %}TRANS_MENU_15{% endtrans %}</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" onclick="alert('{% trans from "messages" %}TRANS_MSG_GUARDAR_ANTES{% endtrans %}');">{% trans %}TRANS_MENU_5{% endtrans %}</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" onclick="alert('{% trans from "messages" %}TRANS_MSG_GUARDAR_ANTES{% endtrans %}');">{% trans %}TRANS_MENU_6{% endtrans %}</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" onclick="alert('{% trans from "messages" %}TRANS_MSG_GUARDAR_ANTES{% endtrans %}');">{% trans %}TRANS_MENU_7{% endtrans %}</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" onclick="alert('{% trans from "messages" %}TRANS_MSG_GUARDAR_ANTES{% endtrans %}');">{% trans %}TRANS_MENU_16{% endtrans %}</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" onclick="alert('{% trans from "messages" %}TRANS_MSG_GUARDAR_ANTES{% endtrans %}');">{% trans %}TRANS_MENU_17{% endtrans %}</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" onclick="alert('{% trans from "messages" %}TRANS_MSG_GUARDAR_ANTES{% endtrans %}');">{% trans from 'revision' %}TRANS_REVISIONES{% endtrans %}</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" onclick="alert('{% trans from "messages" %}TRANS_MSG_GUARDAR_ANTES{% endtrans %}');">{% trans %}TRANS_GESTION_DOCUMENTAL{% endtrans %}</a></li>
                {% endif %}

            </ul>

            <div class="tab-content">
                <div class="tab-pane fade active show" id="tab1">
                    <div class="row">
                        <div class="col-lg-12">
                            {{ form_row(form.anulado) }}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            {{ form_row(form.pruebasEspeciales) }}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-4">
                            {{ form_row(form.estadoAdministrativoVigilanciaSalud) }}
                        </div>
                        <div class="col-lg-4">
                            {{ form_row(form.codigo) }}
                        </div>
                        <div class="col-lg-4">
                            {{ form_row(form.idioma) }}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-4">
                            {{ form_row(form.cif) }}
                            <span class="form-text text-danger incorrectoCif" style="display: none;">{% trans %}TRANS_ERROR_CIF{% endtrans %}</span>
                        </div>
                        <div class="col-lg-4">
                            {{ form_row(form.empresa) }}
                        </div>
                        <div class="col-lg-4">
                            {{ form_row(form.marcaComercial) }}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-4">
                            {{ form_row(form.grupoEmpresa) }}
                        </div>
                        <div class="col-lg-4">
                            {{ form_row(form.logo) }}
                            {% if logo is defined and logo is not empty %}
                                <label style="font-weight: bolder;">{% trans %}TRANS_LOGO_ACTUAL{% endtrans %}</label>
                                <img src="../../../upload/media/logos/{{ logo }}" width="255px" />
                            {% endif %}
                        </div>
                    </div>

                    <fieldset>
                        <legend class="text-uppercase font-size-sm font-weight-bold">{% trans %}TRANS_OTROS_DATOS_INTERES{% endtrans %}</legend>
                        <div class="row">
                            <div class="col-lg-4">
                                {{ form_row(form.colaborador) }}
                                {{ form_row(form.mutua) }}
                            </div>
                            <div class="col-lg-4">
                                {{ form_row(form.spa) }}
                                {{ form_row(form.prescriptor) }}
                            </div>
                            <div class="col-lg-4">
                                {{ form_row(form.modalidadPreventiva) }}
                            </div>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend class="text-uppercase font-size-sm font-weight-bold">{% trans %}TRANS_TELEFONO_EMAIL{% endtrans %}</legend>

                        <div class="row">
                            <div class="col-lg-4">
                                {{ form_row(form.telefono1) }}
                            </div>
                            <div class="col-lg-4">
                                {{ form_row(form.telefono2) }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12">
                                <div class="col-lg-12">
                                    {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                                        {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                                            <a href="#" class="btn btn-labeled btn-labeled-left bg-grey-300" data-toggle="modal" data-target="#modal_añadir_email">{% trans from 'messages' %}TRANS_AÑADIR_EMAIL{% endtrans %}<b><i class="icon-plus3"></i></b></a>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <br/>

                        <div class="row">
                            <div class="col-lg-12">
                                <div class="table-bordered">
                                    <table class="table" id="correos">
                                        <thead>
                                        <tr class="bg-grey-300">
                                            <th>{% trans %}TRANS_EMAIL{% endtrans %}</th>
                                            <th>{% trans %}TRANS_FUNCION_EMAIL{% endtrans %}</th>
                                            <th>{% trans from 'messages' %}TRANS_ACCIONES{% endtrans %}</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% if correos is not empty %}
                                            {% for c in correos %}
                                                <tr>
                                                    <td>{{ c.correo }}</td>
                                                    {% if c.funcion is not null %}
                                                        <td>{{ c.funcion.descripcion }}</td>
                                                    {% else %}
                                                        <td></td>
                                                    {% endif %}
                                                    <td>
                                                        <div class="list-icons">
                                                            {% if app.session.get('privilegiosRol').editEmpresaSn is defined and app.session.get('privilegiosRol').editEmpresaSn is not null %}
                                                                {% if app.session.get('privilegiosRol').editEmpresaSn and impagadaSn is defined and impagadaSn == false %}
                                                                    <a href="#" data-id="{{ c.id }}" target="_self" class="list-icons-item" onclick="recuperaEmail('{{ c.id }}');" data-toggle="modal" data-target="#modal_editar_email"><i class="icon-pencil7"></i></a>
                                                                    <a href="#" data-id="{{ c.id }}" target="_self" class="list-icons-item eliminarEmail"><i class="icon-trash"></i></a>
                                                                {% endif %}
                                                            {% endif %}
                                                        </div>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        {% else %}
                                            <tr>
                                                <td colspan="3" align="center">{% trans from 'messages' %}TRANS_SIN_REGISTROS{% endtrans %}</td>
                                            </tr>
                                        {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend class="text-uppercase font-size-sm font-weight-bold">{% trans %}TRANS_DIRECCION_POSTAL{% endtrans %}</legend>
                        <div class="row">
                            <div class="col-lg-3">
                                {{ form_row(form.domicilioPostal) }}
                            </div>
                            <div class="col-lg-3">
                                {{ form_row(form.localidadPostal) }}
                            </div>
                            <div class="col-lg-3">
                                {{ form_row(form.codigoPostalPostal) }}
                            </div>
                            <div class="col-lg-3">
                                {{ form_row(form.provinciaPostal) }}
                            </div>
                        </div>

                        <h5>{% trans %}TRANS_CODIGO_SERPA{% endtrans %}</h5>

                        <div class="row">
                            <div class="col-lg-6">
                                {{ form_row(form.provinciaPostalSerpa) }}
                            </div>
                            <div class="col-lg-6">
                                {{ form_row(form.municipioPostalSerpa) }}
                            </div>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend class="text-uppercase font-size-sm font-weight-bold">{% trans %}TRANS_CNAE{% endtrans %}</legend>
                        <div class="row">
                            <div class="col-lg-12">
                                {% if (app.request.get('id') is defined and app.request.get('id') is not empty ) %}
                                    {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                                        {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                                            <a href="#" class="btn btn-labeled btn-labeled-left bg-grey-300" data-toggle="modal" data-target="#modal_añadir_cnae">{% trans from 'messages' %}TRANS_AÑADIR_CNAE{% endtrans %}<b><i class="icon-plus3"></i></b></a>
                                        {% endif %}
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        <br/>
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="table-bordered">
                                    <table class="table" id="cnae">
                                        <thead>
                                        <tr class="bg-grey-300">
                                            <th>{% trans %}TRANS_PRINCIPAL_CNAE{% endtrans %}</th>
                                            <th>{% trans %}TRANS_CODIGO_CNAE{% endtrans %}</th>
                                            <th>{% trans %}TRANS_DESCRIPCION_CNAE{% endtrans %}</th>
                                            <th>{% trans from 'messages' %}TRANS_ACCIONES{% endtrans %}</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% if cnae is not empty %}
                                            {% for c in cnae %}
                                                <tr>
                                                    {% if c.principal == true %}
                                                        <td><span class="badge badge-flat border-success text-success-600"><i class="icon-checkmark2"></i></span></td>
                                                    {% else %}
                                                        <td><span class="badge badge-flat border-danger text-danger-600"><i class="icon-cross3"></i></span></td>
                                                    {% endif %}
                                                    {% if c.cnae is not null %}
                                                        <td>{{ c.cnae.cnae }}</td>
                                                        <td>{{ c.cnae.descripcion }}</td>
                                                    {% else %}
                                                        <td></td>
                                                        <td></td>
                                                    {% endif %}
                                                    <td>
                                                        <div class="list-icons">
                                                            {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                                                                {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                                                                    <a href="#" data-id="{{ c.id }}" target="_self" class="list-icons-item" onclick="recuperaCnae('{{ c.id }}');" data-toggle="modal" data-target="#modal_editar_cnae"><i class="icon-pencil7"></i></a>
                                                                    <a href="#" data-id="{{ c.id }}" target="_self" class="list-icons-item eliminarCnae"><i class="icon-trash"></i></a>
                                                                {% endif %}
                                                            {% endif %}
                                                        </div>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        {% else %}
                                            <tr>
                                                <td colspan="4" align="center">{% trans from 'messages' %}TRANS_SIN_REGISTROS{% endtrans %}</td>
                                            </tr>
                                        {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </div>

                <div class="tab-pane fade" id="tab2">
                    <fieldset>
                        <legend class="text-uppercase font-size-sm font-weight-bold">{% trans %}TRANS_USUARIOS_RESPONSABLES{% endtrans %}</legend>
                        <div class="row">
                            <div class="col-lg-4">
                                {{ form_row(form.agente) }}
                            </div>
                            <div class="col-lg-4">
                                {{ form_row(form.vigilanciaSalud) }}
                            </div>
                            <div class="col-lg-4">
                                {{ form_row(form.gestorAdministrativo) }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12">
                                <div class="col-lg-12">
                                    {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                                        {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and app.request.get('id') is defined and app.request.get('id') is not empty and impagadaSn is defined and impagadaSn == false %}
                                            <a href="#" class="btn btn-labeled btn-labeled-left bg-grey-300" data-toggle="modal" data-target="#modal_añadir_tecnico">{% trans from 'messages' %}TRANS_AÑADIR_TECNICO{% endtrans %}<b><i class="icon-plus3"></i></b></a>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <br/>

                        <div class="row">
                            <div class="col-lg-12">
                                <div class="table-bordered">
                                    <table class="table" id="tecnicos">
                                        <thead>
                                        <tr class="bg-grey-300">
                                            <th>{% trans %}TRANS_TECNICO{% endtrans %}</th>
                                            <th>{% trans from 'messages' %}TRANS_ACCIONES{% endtrans %}</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% if tecnicos is not empty %}
                                            {% for t in tecnicos %}
                                                <tr>
                                                    {% if t.tecnico is not null %}
                                                        <td>{{ t.tecnico.nombre }}</td>
                                                    {% else %}
                                                        <td></td>
                                                    {% endif %}
                                                    <td>
                                                        <div class="list-icons">
                                                            {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                                                                {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                                                                    <a href="#" data-id="{{ t.id }}" target="_self" class="list-icons-item" onclick="recuperaTecnico('{{ t.id }}');" data-toggle="modal" data-target="#modal_editar_tecnico"><i class="icon-pencil7"></i></a>
                                                                    <a href="#" data-id="{{ t.id }}" target="_self" class="list-icons-item eliminarTecnico"><i class="icon-trash"></i></a>
                                                                {% endif %}
                                                            {% endif %}
                                                        </div>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        {% else %}
                                            <tr>
                                                <td colspan="2" align="center">{% trans from 'messages' %}TRANS_SIN_REGISTROS{% endtrans %}</td>
                                            </tr>
                                        {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </fieldset>

                    <fieldset>
                        <legend class="text-uppercase font-size-sm font-weight-bold">{% trans %}TRANS_RESPONSABLE_EMPRESA{% endtrans %}</legend>
                        <div class="row">
                            <div class="col-lg-4">
                                {{ form_row(form.nombreRepresentante) }}
                            </div>
                            <div class="col-lg-4">
                                {{ form_row(form.dniRepresentante) }}
                            </div>
                            <div class="col-lg-4">
                                {{ form_row(form.cargoRepresentante) }}
                            </div>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend class="text-uppercase font-size-sm font-weight-bold">{% trans %}TRANS_PERSONAS_CONTACTO{% endtrans %}</legend>
                        <div class="row">
                            <div class="col-lg-12">
                                {{ form_row(form.personaContacto) }}
                            </div>
                        </div>
                    </fieldset>
                </div>

                <div class="tab-pane fade" id="tab3">
                    <div class="row">
                        <div class="col-lg-12">
                            {{ form_row(form.observacionesGenerales) }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-12">
                            {{ form_row(form.observacionesAreaMedicina) }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-12">
                            {{ form_row(form.observacionesAreaTecnica) }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-12">
                            {{ form_row(form.pruebasComplementarias) }}
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab4">
                    <div class="row">
                        <div class="col-lg-12">
                            {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                                {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                                    <a href="#" class="btn btn-labeled btn-labeled-left bg-grey-300" data-toggle="modal" data-target="#modal_añadir_centro">{% trans %}TRANS_AÑADIR_CENTRO{% endtrans %}<b><i class="icon-plus3"></i></b></a>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="table-bordered">
                                <table class="table" id="centroTrabajoEmpresa">
                                    <thead>
                                    <tr class="bg-grey-300">
                                        <th>{% trans %}TRANS_NOMBRE{% endtrans %}</th>
                                        <th>{% trans from 'messages' %}TRANS_ACCIONES{% endtrans %}</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% if centroTrabajoEmpresa is not empty %}
                                        {% for cte in centroTrabajoEmpresa %}
                                            <tr>
                                                <td>{{ cte.centro.nombre }}</td>
                                                <td>
                                                    <div class="list-icons">
                                                        {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                                                            {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                                                                <a href="#" data-id="{{ cte.id }}" target="_self" class="list-icons-item eliminarCentroTrabajo"><i class="icon-trash"></i></a>
                                                            {% endif %}
                                                        {% endif %}
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="2" align="center">{% trans from 'messages' %}TRANS_SIN_REGISTROS{% endtrans %}</td>
                                        </tr>
                                    {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab5">
                    <div class="row">
                        <div class="col-lg-12">
                            {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                                {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                                    <a href="#" class="btn btn-labeled btn-labeled-left bg-grey-300" data-toggle="modal" data-target="#modal_añadir_trabajador">{% trans %}TRANS_AÑADIR_TRABAJADOR{% endtrans %}<b><i class="icon-plus3"></i></b></a>
                               {% endif %}
                            {% endif %}
                        </div>
                    </div>

                    <br/>

                    <div class="row">
                        <div class="col-lg-12">
                            <div id="datatable-trabajadores" class="dataTables_wrapper no-footer">
                                <div class="datatable-scroll">
                                    <table class="table datatable-export-excel-trabajadores dataTable no-footer" id="trabajadoresEmpresa" role="grid" aria-describedby="DataTables_Table_0_info" style="width: 100% !important;">
                                        <thead>
                                        <tr class="bg-grey-300" role="row">
                                            <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1"
                                                aria-label="Nombre" aria-sort="ascending">{% trans %}TRANS_NOMBRE{% endtrans %}
                                            </th>
                                            <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1"
                                                aria-label="DNI">{% trans %}TRANS_DNI_RESPONSABLE_EMPRESA{% endtrans %}
                                            </th>
                                            <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1"
                                                aria-label="Puesto">{% trans from 'revision' %}TRANS_PUESTO_TRABAJO{% endtrans %}
                                            </th>
                                            <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1"
                                                aria-label="UltimaRevision">{% trans from 'trabajadores' %}TRANS_FECHA_ULTIMA_REVISION{% endtrans %}
                                            </th>
                                            <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1"
                                                aria-label="Apto">{% trans from 'revision' %}TRANS_APTO{% endtrans %}
                                            </th>
                                            <th class="text-center sorting_disabled" rowspan="1" colspan="1" aria-label="Actions"
                                                style="width: 100px;">{% trans from 'messages' %}TRANS_ACCIONES{% endtrans %}
                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab6">
                    <div class="row">
                        <div class="col-lg-12">
                            {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                                {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                                    <a href="#" class="btn btn-labeled btn-labeled-left bg-grey-300" data-toggle="modal" data-target="#modal_generar_memoria">{% trans %}TRANS_GENERAR_MEMORIA{% endtrans %}<b><i class="icon-plus3"></i></b></a>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>

                    <br/>

                    <div class="row">
                        <div class="col-lg-12">
                            <div id="datatable-memorias" class="dataTables_wrapper no-footer">
                                <div class="datatable-scroll">
                                    <table class="table datatable-export-excel-memorias dataTable no-footer" id="memoriasEmpresa" role="grid" aria-describedby="DataTables_Table_0_info" style="width: 100% !important;">
                                        <thead>
                                        <tr class="bg-grey-300" role="row">
                                            <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1"
                                                aria-label="Anyo" aria-sort="ascending">{% trans %}TRANS_AÑO{% endtrans %}
                                            </th>
                                            <th class="text-center sorting_disabled" rowspan="1" colspan="1" aria-label="Actions"
                                                style="width: 100px;">{% trans from 'messages' %}TRANS_ACCIONES{% endtrans %}
                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab7">
                    <div class="row">
                        <div class="col-lg-12">
                            {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                                {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                                    <a href="#" class="btn btn-labeled btn-labeled-left bg-grey-300" data-toggle="modal" data-target="#modal_generar_estudio">{% trans %}TRANS_GENERAR_ESTUDIO{% endtrans %}<b><i class="icon-plus3"></i></b></a>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>

                    <br/>

                    <div class="row">
                        <div class="col-lg-12">
                            <div id="datatable-estudios" class="dataTables_wrapper no-footer">
                                <div class="datatable-scroll">
                                    <table class="table datatable-export-excel-estudios dataTable no-footer" id="estudiosEmpresa" role="grid" aria-describedby="DataTables_Table_0_info" style="width: 100% !important;">
                                        <thead>
                                        <tr class="bg-grey-300" role="row">
                                            <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1"
                                                aria-label="Anyo" aria-sort="ascending">{% trans %}TRANS_AÑO{% endtrans %}
                                            </th>
                                            <th class="text-center sorting_disabled" rowspan="1" colspan="1" aria-label="Actions"
                                                style="width: 100px;">{% trans from 'messages' %}TRANS_ACCIONES{% endtrans %}
                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab8">
                    <div class="row">
                        <div class="col-lg-12">
                            <div id="datatable-revisiones" class="dataTables_wrapper no-footer">
                                <div class="datatable-scroll">
                                    <table class="table datatable-export-excel-revisiones dataTable no-footer" id="memoriasEmpresa" role="grid" aria-describedby="DataTables_Table_0_info" style="width: 100% !important;">
                                        <thead>
                                        <tr class="bg-grey-300" role="row">
                                            <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1" aria-label="Estado">{% trans from 'revision' %}TRANS_ESTADO{% endtrans %}</th>
                                            <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1" aria-label="Fecha">{% trans from 'revision' %}TRANS_FECHA{% endtrans %}</th>
                                            <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1" aria-label="Trabajador">{% trans from 'revision' %}TRANS_TRABAJADOR{% endtrans %}</th>
                                            <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1" aria-label="PuestoTrabajo">{% trans from 'revision' %}TRANS_PUESTO_TRABAJO{% endtrans %}</th>
                                            <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1" aria-label="Empresa">{% trans from 'revision' %}TRANS_EMPRESA{% endtrans %}</th>
                                            <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1" aria-label="Doctor">{% trans from 'revision' %}TRANS_MEDICO{% endtrans %}</th>
                                            <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1" aria-label="Apto">{% trans from 'revision' %}TRANS_APTO{% endtrans %}</th>
                                            <th class="text-center sorting_disabled" rowspan="1" colspan="1" aria-label="Actions" style="width: 100px;">{% trans from 'messages' %}TRANS_ACCIONES{% endtrans %}</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab9">
                    <div class="row">
                        <div class="col-lg-12">
                            {% if app.session.get('privilegiosRol').addGdocSn is defined and app.session.get('privilegiosRol').addGdocSn is not null %}
                                {% if app.session.get('privilegiosRol').addGdocSn and impagadaSn is defined and impagadaSn == false %}
                                    <a href="#" class="btn btn-labeled btn-labeled-left bg-primary" style="margin-right: 10px;" data-toggle="modal" data-target="#modal_añadir_carpeta">{% trans from 'gdoc' %}TRANS_ADD_CARPETA{% endtrans %}<b><i class="icon-folder-plus"></i></b></a>
                                {% endif %}
                            {% endif %}

                            {% if app.session.get('privilegiosRol').addGdocFileSn is defined and app.session.get('privilegiosRol').addGdocFileSn is not null %}
                                {% if app.session.get('privilegiosRol').addGdocFileSn and impagadaSn is defined and impagadaSn == false %}
                                    <a href="#" class="btn btn-labeled btn-labeled-left bg-success" data-toggle="modal" data-target="#modal_añadir_fichero">{% trans from 'gdoc' %}TRANS_AÑADIR_FICHERO{% endtrans %}<b><i class="icon-file-upload"></i></b></a>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>

                    <br/>

                    <div class="row">
                        <div class="col-lg-12">
                            <div id="tree" style="border: 1px solid #DDD; border-radius: 5px; padding:20px; margin:0 auto;"></div>
                        </div>
                    </div>
                </div>
            </div>

        <div class="card-footer d-flex justify-content-between align-items-center border-top-0">
            {% if app.session.get('privilegiosRol').editEmpresaMedicoSn is defined and app.session.get('privilegiosRol').editEmpresaMedicoSn is not null %}
                {% if app.session.get('privilegiosRol').editEmpresaMedicoSn and impagadaSn is defined and impagadaSn == false %}
                    {{ form_row(form.guardar) }}
                {% else %}
                    {{ form_row(form.guardar, {'attr': {'style': 'display: none;'}}) }}
                {% endif %}
            {% else %}
                {{ form_row(form.guardar, {'attr': {'style': 'display: none;'}}) }}
            {% endif %}
        </div>

        {{ form_end(form) }}
    </div>

    <!-- Modal añadir cnae -->
    <div id="modal_añadir_cnae" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{% trans %}TRANS_AÑADIR_CNAE{% endtrans %}</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <div class="modal-body">
                    <label>{% trans %}TRANS_CNAE{% endtrans %}</label>
                    <select id="cnaeValor" class="select-search form-control">
                        <option value=""></option>
                        {% if listCnae is not empty %}
                            {% for lc in listCnae %}
                                <option value="{{ lc.id }}">{{ lc.cnae }} - {{ lc.descripcion }}</option>
                            {% endfor %}
                        {% endif %}
                    </select>

                    <br/>
                    <br/>

                    <div class="form-check">
                        <input type="checkbox" id="principal" name="principal" class="form-check-input-styled form-check-input" value="1" checked="checked" />
                        <label class="form-check-label" for="principal">Principal</label>
                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn bg-primary" id="btnAddCnae">{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /Modal añadir cnae -->

    <!-- Modal editar cnae -->
    <div id="modal_editar_cnae" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{% trans %}TRANS_EDITAR_CNAE{% endtrans %}</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <label>{% trans %}TRANS_CNAE{% endtrans %}</label>
                    <select id="cnaeValorEditar" class="select-search form-control">
                        <option value=""></option>
                        {% if listCnae is not empty %}
                            {% for lc in listCnae %}
                                <option value="{{ lc.id }}">{{ lc.cnae }} - {{ lc.descripcion }}</option>
                            {% endfor %}
                        {% endif %}
                    </select>

                    <br/>
                    <br/>

                    <div class="form-check">
                        <input type="checkbox" id="principalEditar" name="principalEditar" class="form-check-input-styled form-check-input" value="1" checked="checked" />
                        <label class="form-check-label" for="principal">Principal</label>
                    </div>

                    <input type="hidden" id="cnaeEmpresaIdEditar" />
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn bg-primary" id="btnUpdateCnae">Guardar</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /Modal editar cnae -->

    <!-- Modal añadir trabajador -->
    <div id="modal_añadir_trabajador" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{% trans %}TRANS_AÑADIR_TRABAJADOR{% endtrans %}</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <div class="modal-body">
                    <label>{% trans %}TRANS_TRABAJADOR{% endtrans %}</label>
                    <select id="trabajadorEmpresa" class="form-control js_busca_ajax_trabajador" data-fouc>
                    </select>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn bg-primary" id="btnAddTrabajador">{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /Modal añadir trabajador -->

    <!-- Modal añadir centro -->
    <div id="modal_añadir_centro" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{% trans %}TRANS_AÑADIR_CENTRO{% endtrans %}</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <div class="modal-body">
                    <label>{% trans %}TRANS_CENTRO_TRABAJO{% endtrans %}</label>
                    <select id="centroTrabajo" class="form-control js_busca_ajax_centro" data-fouc>
                    </select>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn bg-primary" id="btnAddCentroTrabajoEmpresa">{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /Modal añadir centro -->

    <!-- Modal añadir correo -->
    <div id="modal_añadir_email" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{% trans %}TRANS_AÑADIR_CORREO{% endtrans %}</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <div class="modal-body">
                    <label>{% trans %}TRANS_EMAIL{% endtrans %}</label>
                    <input type="text" id="email" class="form-control" />

                    <label>{% trans %}TRANS_FUNCION_EMAIL{% endtrans %}</label>
                    <select id="funcion" class="select-search form-control">
                        <option value=""></option>
                        {% if listFuncionCorreo is not empty %}
                            {% for lf in listFuncionCorreo %}
                                <option value="{{ lf.id }}">{{ lf.descripcion }}</option>
                            {% endfor %}
                        {% endif %}
                    </select>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn bg-primary" id="btnAddCorreo">{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /Modal añadir correo -->

    <!-- Modal editar correo -->
    <div id="modal_editar_email" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{% trans %}TRANS_EDITAR_CORREO{% endtrans %}</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <div class="modal-body">
                    <label>{% trans %}TRANS_EMAIL{% endtrans %}</label>
                    <input type="text" id="emailEditar" class="form-control" />

                    <label>{% trans %}TRANS_FUNCION_EMAIL{% endtrans %}</label>
                    <select id="funcionEditar" class="select-search form-control">
                        <option value=""></option>
                        {% if listFuncionCorreo is not empty %}
                            {% for lf in listFuncionCorreo %}
                                <option value="{{ lf.id }}">{{ lf.descripcion }}</option>
                            {% endfor %}
                        {% endif %}
                    </select>

                    <input type="hidden" id="correoEmpresaIdEditar" />
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn bg-primary" id="btnUpdateCorreo">Guardar</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /Modal editar correo -->

        <!-- Modal añadir tecnico -->
        <div id="modal_añadir_tecnico" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{% trans %}TRANS_AÑADIR_TECNICO{% endtrans %}</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <div class="modal-body">
                        <label>{% trans %}TRANS_TECNICO{% endtrans %}</label>
                        <select id="tecnico" class="select-search form-control">
                            <option value=""></option>
                            {% if listTecnicos is not empty %}
                                {% for lt in listTecnicos %}
                                    <option value="{{ lt.id }}">{{ lt.nombre }}</option>
                                {% endfor %}
                            {% endif %}
                        </select>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn bg-primary" id="btnAddTecnico">{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Modal añadir tecnico -->

        <!-- Modal editar tecnico -->
        <div id="modal_editar_tecnico" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{% trans %}TRANS_EDITAR_TECNICO{% endtrans %}</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <div class="modal-body">
                        <label>{% trans %}TRANS_TECNICO{% endtrans %}</label>
                        <select id="tecnicoEditar" class="select-search form-control">
                            <option value=""></option>
                            {% if listTecnicos is not empty %}
                                {% for lt in listTecnicos %}
                                    <option value="{{ lt.id }}">{{ lt.nombre }}</option>
                                {% endfor %}
                            {% endif %}
                        </select>
                        <input type="hidden" id="tecnicoEmpresaId" />
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn bg-primary" id="btnUpdateTecnico">Guardar</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Modal editar tecnico -->

        <!-- Modal generar memoria -->
        <div id="modal_generar_memoria" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{% trans %}TRANS_GENERAR_MEMORIA{% endtrans %}</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <div class="modal-body">
                        <label>{% trans from 'messages' %}TRANS_PLANTILLA{% endtrans %}</label>
                        <select id="plantillaMemoria" class="select-search form-control">
                            <option value=""></option>
                            {% if listPlantillasMemoria is not empty %}
                                {% for lpm in listPlantillasMemoria %}
                                    <option value="{{ lpm.id }}">{{ lpm.nombre }}</option>
                                {% endfor %}
                            {% endif %}
                        </select>

                        <br/>

                        <label>{% trans %}TRANS_AÑO{% endtrans %}</label>
                        <input type="number" class="form-control" id="anyoMemoria" min="1900" max="2999" />
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn bg-primary" id="btnGenerarMemoria">{% trans from 'messages' %}TRANS_IMPRIMIR{% endtrans %}</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Modal generar memoria -->

        <!-- Modal generar estudio -->
        <div id="modal_generar_estudio" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{% trans %}TRANS_GENERAR_ESTUDIO{% endtrans %}</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <div class="modal-body">
                        <label>{% trans from 'messages' %}TRANS_PLANTILLA{% endtrans %}</label>
                        <select id="plantillaEstudio" class="select-search form-control">
                            <option value=""></option>
                            {% if listPlantillasEstudio is not empty %}
                                {% for lpe in listPlantillasEstudio %}
                                    <option value="{{ lpe.id }}">{{ lpe.nombre }}</option>
                                {% endfor %}
                            {% endif %}
                        </select>

                        <br/>

                        <label>{% trans %}TRANS_AÑO{% endtrans %}</label>
                        <input type="number" class="form-control" id="anyoEstudio" min="1900" max="2999" />
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn bg-primary" id="btnGenerarEstudio">{% trans from 'messages' %}TRANS_IMPRIMIR{% endtrans %}</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Modal generar estudio -->

        <!-- Modal generacion resumen revision -->
        <div id="modal_resumen_revision" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{% trans from 'revision' %}TRANS_IMPRIMIR_RESUMEN_REVISION{% endtrans %}</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <div class="modal-body">
                        <label>{% trans from 'messages' %}TRANS_PLANTILLA{% endtrans %}</label>
                        <select id="plantilla" class="select-search form-control">
                            <option value=""></option>
                            {% if listPlantillasResumen is defined and listPlantillasResumen is not empty %}
                                {% for lp in listPlantillasResumen %}
                                    <option value="{{ lp.id }}">{{ lp.nombre }}</option>
                                {% endfor %}
                            {% endif %}
                        </select>

                        <input type="hidden" id="revisionId" class="form-control"/>

                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn bg-primary" id="btnResumenRevision">{% trans from 'messages' %}TRANS_IMPRIMIR{% endtrans %}</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Modal generacion resumen revision -->

        <!-- Modal imprimir aptitud -->
        <div id="modal_print_aptitud" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{% trans from 'revision' %}TRANS_IMPRIMIR_APTITUD{% endtrans %}</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <div class="modal-body">
                        <label>{% trans from 'messages' %}TRANS_PLANTILLA{% endtrans %}</label>
                        <select id="plantillaAptitud" class="select-search form-control">
                            <option value=""></option>
                            {% if listPlantillasAptitud is defined and listPlantillasAptitud is not empty %}
                                {% for lpa in listPlantillasAptitud %}
                                    <option value="{{ lpa.id }}">{{ lpa.nombre }}</option>
                                {% endfor %}
                            {% endif %}
                        </select>

                        <input type="hidden" id="aptitudId" class="form-control"/>

                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn bg-primary" id="btnImprimirAptitud">{% trans from 'messages' %}TRANS_IMPRIMIR{% endtrans %}</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Modal imprimir aptitud -->

        <!-- Modal añadir carpeta -->
        <div id="modal_añadir_carpeta" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{% trans from 'gdoc' %}TRANS_ADD_CARPETA{% endtrans %}</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <div class="modal-body">
                        <label>{% trans from 'gdoc' %}TRANS_NOMBRE_CARPETA{% endtrans %}</label>
                        <input type="text" id="nombreCarpeta" class="form-control" />

                        <label>{% trans from 'gdoc' %}TRANS_PADRE{% endtrans %}</label>
                        <select id="carpetaPadre" class="select-search form-control">
                            <option value=""></option>
                            {% if carpetas is not empty %}
                                {% for c in carpetas %}
                                    <option value="{{ c.id }}">{{ c.nombre }}</option>
                                {% endfor %}
                            {% endif %}
                        </select>

                    </div>

                    <div class="modal-footer">
                        {% if app.session.get('privilegiosRol').addGdocSn is defined and app.session.get('privilegiosRol').addGdocSn is not null %}
                            {% if app.session.get('privilegiosRol').addGdocSn %}
                                <button type="button" class="btn bg-primary" id="btnAddCarpeta">{% trans from 'messages' %}TRANS_AÑADIR{% endtrans %}</button>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal añadir carpeta -->

        <!-- Modal editar carpeta -->
        <div id="modal_editar_carpeta" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{% trans from 'gdoc' %}TRANS_EDIT_CARPETA{% endtrans %}</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <div class="modal-body">
                        <label>{% trans from 'gdoc' %}TRANS_NOMBRE_CARPETA{% endtrans %}</label>
                        <input type="text" id="nombreCarpetaEditar" class="form-control" />

                        <label>{% trans from 'gdoc' %}TRANS_PADRE{% endtrans %}</label>
                        <select id="carpetaPadreEditar" class="select-search form-control">
                            <option value=""></option>
                            {% if carpetas is defined and carpetas is not empty %}
                                {% for c in carpetas %}
                                    <option value="{{ c.id }}">{{ c.nombre }}</option>
                                {% endfor %}
                            {% endif %}
                        </select>

                        <input type="hidden" id="idCarpeta" class="form-control" />

                    </div>

                    <div class="modal-footer">
                        {% if app.session.get('privilegiosRol').editGdocSn is defined and app.session.get('privilegiosRol').editGdocSn is not null %}
                            {% if app.session.get('privilegiosRol').editGdocSn %}
                                <button type="button" class="btn bg-primary" id="btnUpdateCarpeta">Guardar</button>
                            {% endif %}
                        {% endif %}
                        {% if app.session.get('privilegiosRol').deleteGdocSn is defined and app.session.get('privilegiosRol').deleteGdocSn is not null %}
                            {% if app.session.get('privilegiosRol').deleteGdocSn %}
                                <button type="button" class="btn bg-danger" id="btnDeleteCarpeta">Eliminar</button>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal editar carpeta -->

        <!-- Modal view fichero -->
        <div id="modal_view_fichero" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{% trans from 'gdoc' %}TRANS_DATOS_FICHERO{% endtrans %}</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <div class="modal-body">
                        <label>{% trans from 'gdoc' %}TRANS_NOMBRE_FICHERO{% endtrans %}</label>
                        <input type="text" id="nombreFichero" class="form-control" disabled="disabled" />

                        <label>{% trans from 'gdoc' %}TRANS_FECHA_FICHERO{% endtrans %}</label>
                        <input type="text" id="fechaFichero" class="form-control" disabled="disabled" />

                        <label>{% trans from 'gdoc' %}TRANS_NOMBRE_USUARIO_FICHERO{% endtrans %}</label>
                        <input type="text" id="usuarioFichero" class="form-control" disabled="disabled" />

                        <label>{% trans from 'gdoc' %}TRANS_TIPO_FICHERO{% endtrans %}</label>
                        <input type="text" id="tipoFichero" class="form-control" disabled="disabled" />

                        <label>{% trans from 'gdoc' %}TRANS_MIDA_FICHERO{% endtrans %}</label>
                        <input type="text" id="midaFichero" class="form-control" disabled="disabled" />

                        <input type="hidden" id="idFichero" class="form-control" />

                    </div>

                    <div class="modal-footer">

                        {% if app.session.get('privilegiosRol').openGdocFileSn is defined and app.session.get('privilegiosRol').openGdocFileSn is not null %}
                            {% if app.session.get('privilegiosRol').openGdocFileSn %}
                                {% if app.session.get('empresa') is defined and app.session.get('empresa') is not null %}
                                    <a href="#" id="btnOpenPlantilla" class="btn btn-labeled btn-labeled-left bg-primary" target="_blank">{% trans from 'messages' %}TRANS_OPEN{% endtrans %}<b><i class="icon-file-eye"></i></b></a>
                                {% else %}
                                    <a href="#" class="btn btn-labeled btn-labeled-left bg-primary noEmpresa">{% trans from 'messages' %}TRANS_OPEN{% endtrans %}<b><i class="icon-file-eye"></i></b></a>
                                {% endif %}
                            {% endif %}
                        {% endif %}

                        {% if app.session.get('privilegiosRol').downGdocFileSn is defined and app.session.get('privilegiosRol').downGdocFileSn is not null %}
                            {% if app.session.get('privilegiosRol').downGdocFileSn %}
                                <a href="#" id="btnDownPlantilla" class="btn btn-labeled btn-labeled-left bg-success" target="_blank">{% trans from 'messages' %}TRANS_DOWN{% endtrans %}<b><i class="icon-file-download"></i></b></a>
                            {% endif %}
                        {% endif %}

                        {% if app.session.get('privilegiosRol').deleteGdocFileSn is defined and app.session.get('privilegiosRol').deleteGdocFileSn is not null %}
                            {% if app.session.get('privilegiosRol').deleteGdocFileSn %}
                                <button type="button" class="btn btn-labeled btn-labeled-left bg-danger" id="btnDeletePlantilla">{% trans from 'messages' %}TRANS_ELIMINAR{% endtrans %}<b><i class="icon-cross2"></i></b></button>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal view fichero -->

        <!-- Modal añadir fichero -->
        <div id="modal_añadir_fichero" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{% trans from 'gdoc' %}TRANS_AÑADIR_FICHERO{% endtrans %}</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <div class="modal-body">
                        {{ form_start(form2) }}

                        <div class="row">
                            <div class="col-lg-12">
                                {{ form_row(form2.nombre) }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12">
                                {{ form_row(form2.media) }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12">
                                {{ form_row(form2.carpeta) }}
                            </div>
                        </div>

                        {{ form_end(form2) }}

                    </div>

                    <div class="modal-footer">
                        {% if app.session.get('privilegiosRol').addGdocSn is defined and app.session.get('privilegiosRol').addGdocSn is not null %}
                            {% if app.session.get('privilegiosRol').addGdocSn %}
                                {{ form_row(form2.guardar) }}
                            {% else %}
                                {{ form_row(form2.guardar, {'attr': {'style': 'display: none;'}}) }}
                            {% endif %}
                        {% else %}
                            {{ form_row(form2.guardar, {'attr': {'style': 'display: none;'}}) }}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal añadir fichero -->

{% endblock %}